{"ast":null,"code":"import { minify, _default_options } from \"../main.js\";\nimport { parse } from \"./parse.js\";\nimport { AST_Assign, AST_Array, AST_Constant, AST_Node, AST_PropAccess, AST_RegExp, AST_Sequence, AST_Symbol, AST_Token, walk } from \"./ast.js\";\nimport { OutputStream } from \"./output.js\";\nexport async function run_cli({\n  program,\n  packageJson,\n  fs,\n  path\n}) {\n  const skip_keys = new Set([\"cname\", \"parent_scope\", \"scope\", \"uses_eval\", \"uses_with\"]);\n  var files = {};\n  var options = {\n    compress: false,\n    mangle: false\n  };\n  const default_options = await _default_options();\n  program.version(packageJson.name + \" \" + packageJson.version);\n  program.parseArgv = program.parse;\n  program.parse = undefined;\n  if (process.argv.includes(\"ast\")) program.helpInformation = describe_ast;else if (process.argv.includes(\"options\")) program.helpInformation = function () {\n    var text = [];\n\n    for (var option in default_options) {\n      text.push(\"--\" + (option === \"sourceMap\" ? \"source-map\" : option) + \" options:\");\n      text.push(format_object(default_options[option]));\n      text.push(\"\");\n    }\n\n    return text.join(\"\\n\");\n  };\n  program.option(\"-p, --parse <options>\", \"Specify parser options.\", parse_js());\n  program.option(\"-c, --compress [options]\", \"Enable compressor/specify compressor options.\", parse_js());\n  program.option(\"-m, --mangle [options]\", \"Mangle names/specify mangler options.\", parse_js());\n  program.option(\"--mangle-props [options]\", \"Mangle properties/specify mangler options.\", parse_js());\n  program.option(\"-f, --format [options]\", \"Format options.\", parse_js());\n  program.option(\"-b, --beautify [options]\", \"Alias for --format beautify=true.\", parse_js());\n  program.option(\"-o, --output <file>\", \"Output file (default STDOUT).\");\n  program.option(\"--comments [filter]\", \"Preserve copyright comments in the output.\");\n  program.option(\"--config-file <file>\", \"Read minify() options from JSON file.\");\n  program.option(\"-d, --define <expr>[=value]\", \"Global definitions.\", parse_js(\"define\"));\n  program.option(\"--ecma <version>\", \"Specify ECMAScript release: 5, 2015, 2016 or 2017...\");\n  program.option(\"-e, --enclose [arg[,...][:value[,...]]]\", \"Embed output in a big function with configurable arguments and values.\");\n  program.option(\"--ie8\", \"Support non-standard Internet Explorer 8.\");\n  program.option(\"--keep-classnames\", \"Do not mangle/drop class names.\");\n  program.option(\"--keep-fnames\", \"Do not mangle/drop function names. Useful for code relying on Function.prototype.name.\");\n  program.option(\"--module\", \"Input is an ES6 module\");\n  program.option(\"--name-cache <file>\", \"File to hold mangled name mappings.\");\n  program.option(\"--rename\", \"Force symbol expansion.\");\n  program.option(\"--no-rename\", \"Disable symbol expansion.\");\n  program.option(\"--safari10\", \"Support non-standard Safari 10.\");\n  program.option(\"--source-map [options]\", \"Enable source map/specify source map options.\", parse_js());\n  program.option(\"--timings\", \"Display operations run time on STDERR.\");\n  program.option(\"--toplevel\", \"Compress and/or mangle variables in toplevel scope.\");\n  program.option(\"--wrap <name>\", \"Embed everything as a function with “exports” corresponding to “name” globally.\");\n  program.arguments(\"[files...]\").parseArgv(process.argv);\n\n  if (program.configFile) {\n    options = JSON.parse(read_file(program.configFile));\n  }\n\n  if (!program.output && program.sourceMap && program.sourceMap.url != \"inline\") {\n    fatal(\"ERROR: cannot write source map to STDOUT\");\n  }\n\n  [\"compress\", \"enclose\", \"ie8\", \"mangle\", \"module\", \"safari10\", \"sourceMap\", \"toplevel\", \"wrap\"].forEach(function (name) {\n    if (name in program) {\n      options[name] = program[name];\n    }\n  });\n\n  if (\"ecma\" in program) {\n    if (program.ecma != (program.ecma | 0)) fatal(\"ERROR: ecma must be an integer\");\n    const ecma = program.ecma | 0;\n    if (ecma > 5 && ecma < 2015) options.ecma = ecma + 2009;else options.ecma = ecma;\n  }\n\n  if (program.beautify || program.format) {\n    if (program.beautify && program.format) {\n      fatal(\"Please only specify one of --beautify or --format\");\n    }\n\n    if (program.beautify) {\n      options.format = typeof program.beautify == \"object\" ? program.beautify : {};\n\n      if (!(\"beautify\" in options.format)) {\n        options.format.beautify = true;\n      }\n    }\n\n    if (program.format) {\n      options.format = typeof program.format == \"object\" ? program.format : {};\n    }\n  }\n\n  if (program.comments) {\n    if (typeof options.format != \"object\") options.format = {};\n    options.format.comments = typeof program.comments == \"string\" ? program.comments == \"false\" ? false : program.comments : \"some\";\n  }\n\n  if (program.define) {\n    if (typeof options.compress != \"object\") options.compress = {};\n    if (typeof options.compress.global_defs != \"object\") options.compress.global_defs = {};\n\n    for (var expr in program.define) {\n      options.compress.global_defs[expr] = program.define[expr];\n    }\n  }\n\n  if (program.keepClassnames) {\n    options.keep_classnames = true;\n  }\n\n  if (program.keepFnames) {\n    options.keep_fnames = true;\n  }\n\n  if (program.mangleProps) {\n    if (program.mangleProps.domprops) {\n      delete program.mangleProps.domprops;\n    } else {\n      if (typeof program.mangleProps != \"object\") program.mangleProps = {};\n      if (!Array.isArray(program.mangleProps.reserved)) program.mangleProps.reserved = [];\n    }\n\n    if (typeof options.mangle != \"object\") options.mangle = {};\n    options.mangle.properties = program.mangleProps;\n  }\n\n  if (program.nameCache) {\n    options.nameCache = JSON.parse(read_file(program.nameCache, \"{}\"));\n  }\n\n  if (program.output == \"ast\") {\n    options.format = {\n      ast: true,\n      code: false\n    };\n  }\n\n  if (program.parse) {\n    if (!program.parse.acorn && !program.parse.spidermonkey) {\n      options.parse = program.parse;\n    } else if (program.sourceMap && program.sourceMap.content == \"inline\") {\n      fatal(\"ERROR: inline source map only works with built-in parser\");\n    }\n  }\n\n  if (~program.rawArgs.indexOf(\"--rename\")) {\n    options.rename = true;\n  } else if (!program.rename) {\n    options.rename = false;\n  }\n\n  let convert_path = name => name;\n\n  if (typeof program.sourceMap == \"object\" && \"base\" in program.sourceMap) {\n    convert_path = function () {\n      var base = program.sourceMap.base;\n      delete options.sourceMap.base;\n      return function (name) {\n        return path.relative(base, name);\n      };\n    }();\n  }\n\n  let filesList;\n\n  if (options.files && options.files.length) {\n    filesList = options.files;\n    delete options.files;\n  } else if (program.args.length) {\n    filesList = program.args;\n  }\n\n  if (filesList) {\n    simple_glob(filesList).forEach(function (name) {\n      files[convert_path(name)] = read_file(name);\n    });\n  } else {\n    await new Promise(resolve => {\n      var chunks = [];\n      process.stdin.setEncoding(\"utf8\");\n      process.stdin.on(\"data\", function (chunk) {\n        chunks.push(chunk);\n      }).on(\"end\", function () {\n        files = [chunks.join(\"\")];\n        resolve();\n      });\n      process.stdin.resume();\n    });\n  }\n\n  await run_cli();\n\n  function convert_ast(fn) {\n    return AST_Node.from_mozilla_ast(Object.keys(files).reduce(fn, null));\n  }\n\n  async function run_cli() {\n    var content = program.sourceMap && program.sourceMap.content;\n\n    if (content && content !== \"inline\") {\n      options.sourceMap.content = read_file(content, content);\n    }\n\n    if (program.timings) options.timings = true;\n\n    try {\n      if (program.parse) {\n        if (program.parse.acorn) {\n          files = convert_ast(function (toplevel, name) {\n            return require(\"acorn\").parse(files[name], {\n              ecmaVersion: 2018,\n              locations: true,\n              program: toplevel,\n              sourceFile: name,\n              sourceType: options.module || program.parse.module ? \"module\" : \"script\"\n            });\n          });\n        } else if (program.parse.spidermonkey) {\n          files = convert_ast(function (toplevel, name) {\n            var obj = JSON.parse(files[name]);\n            if (!toplevel) return obj;\n            toplevel.body = toplevel.body.concat(obj.body);\n            return toplevel;\n          });\n        }\n      }\n    } catch (ex) {\n      fatal(ex);\n    }\n\n    let result;\n\n    try {\n      result = await minify(files, options);\n    } catch (ex) {\n      if (ex.name == \"SyntaxError\") {\n        print_error(\"Parse error at \" + ex.filename + \":\" + ex.line + \",\" + ex.col);\n        var col = ex.col;\n        var lines = files[ex.filename].split(/\\r?\\n/);\n        var line = lines[ex.line - 1];\n\n        if (!line && !col) {\n          line = lines[ex.line - 2];\n          col = line.length;\n        }\n\n        if (line) {\n          var limit = 70;\n\n          if (col > limit) {\n            line = line.slice(col - limit);\n            col = limit;\n          }\n\n          print_error(line.slice(0, 80));\n          print_error(line.slice(0, col).replace(/\\S/g, \" \") + \"^\");\n        }\n      }\n\n      if (ex.defs) {\n        print_error(\"Supported options:\");\n        print_error(format_object(ex.defs));\n      }\n\n      fatal(ex);\n      return;\n    }\n\n    if (program.output == \"ast\") {\n      if (!options.compress && !options.mangle) {\n        result.ast.figure_out_scope({});\n      }\n\n      console.log(JSON.stringify(result.ast, function (key, value) {\n        if (value) switch (key) {\n          case \"thedef\":\n            return symdef(value);\n\n          case \"enclosed\":\n            return value.length ? value.map(symdef) : undefined;\n\n          case \"variables\":\n          case \"functions\":\n          case \"globals\":\n            return value.size ? collect_from_map(value, symdef) : undefined;\n        }\n        if (skip_keys.has(key)) return;\n        if (value instanceof AST_Token) return;\n        if (value instanceof Map) return;\n\n        if (value instanceof AST_Node) {\n          var result = {\n            _class: \"AST_\" + value.TYPE\n          };\n\n          if (value.block_scope) {\n            result.variables = value.block_scope.variables;\n            result.functions = value.block_scope.functions;\n            result.enclosed = value.block_scope.enclosed;\n          }\n\n          value.CTOR.PROPS.forEach(function (prop) {\n            result[prop] = value[prop];\n          });\n          return result;\n        }\n\n        return value;\n      }, 2));\n    } else if (program.output == \"spidermonkey\") {\n      try {\n        const minified = await minify(result.code, {\n          compress: false,\n          mangle: false,\n          format: {\n            ast: true,\n            code: false\n          }\n        });\n        console.log(JSON.stringify(minified.ast.to_mozilla_ast(), null, 2));\n      } catch (ex) {\n        fatal(ex);\n        return;\n      }\n    } else if (program.output) {\n      fs.writeFileSync(program.output, result.code);\n\n      if (options.sourceMap && options.sourceMap.url !== \"inline\" && result.map) {\n        fs.writeFileSync(program.output + \".map\", result.map);\n      }\n    } else {\n      console.log(result.code);\n    }\n\n    if (program.nameCache) {\n      fs.writeFileSync(program.nameCache, JSON.stringify(options.nameCache));\n    }\n\n    if (result.timings) for (var phase in result.timings) {\n      print_error(\"- \" + phase + \": \" + result.timings[phase].toFixed(3) + \"s\");\n    }\n  }\n\n  function fatal(message) {\n    if (message instanceof Error) message = message.stack.replace(/^\\S*?Error:/, \"ERROR:\");\n    print_error(message);\n    process.exit(1);\n  } // A file glob function that only supports \"*\" and \"?\" wildcards in the basename.\n  // Example: \"foo/bar/*baz??.*.js\"\n  // Argument `glob` may be a string or an array of strings.\n  // Returns an array of strings. Garbage in, garbage out.\n\n\n  function simple_glob(glob) {\n    if (Array.isArray(glob)) {\n      return [].concat.apply([], glob.map(simple_glob));\n    }\n\n    if (glob && glob.match(/[*?]/)) {\n      var dir = path.dirname(glob);\n\n      try {\n        var entries = fs.readdirSync(dir);\n      } catch (ex) {}\n\n      if (entries) {\n        var pattern = \"^\" + path.basename(glob).replace(/[.+^$[\\]\\\\(){}]/g, \"\\\\$&\").replace(/\\*/g, \"[^/\\\\\\\\]*\").replace(/\\?/g, \"[^/\\\\\\\\]\") + \"$\";\n        var mod = process.platform === \"win32\" ? \"i\" : \"\";\n        var rx = new RegExp(pattern, mod);\n        var results = entries.filter(function (name) {\n          return rx.test(name);\n        }).map(function (name) {\n          return path.join(dir, name);\n        });\n        if (results.length) return results;\n      }\n    }\n\n    return [glob];\n  }\n\n  function read_file(path, default_value) {\n    try {\n      return fs.readFileSync(path, \"utf8\");\n    } catch (ex) {\n      if ((ex.code == \"ENOENT\" || ex.code == \"ENAMETOOLONG\") && default_value != null) return default_value;\n      fatal(ex);\n    }\n  }\n\n  function parse_js(flag) {\n    return function (value, options) {\n      options = options || {};\n\n      try {\n        walk(parse(value, {\n          expression: true\n        }), node => {\n          if (node instanceof AST_Assign) {\n            var name = node.left.print_to_string();\n            var value = node.right;\n\n            if (flag) {\n              options[name] = value;\n            } else if (value instanceof AST_Array) {\n              options[name] = value.elements.map(to_string);\n            } else if (value instanceof AST_RegExp) {\n              value = value.value;\n              options[name] = new RegExp(value.source, value.flags);\n            } else {\n              options[name] = to_string(value);\n            }\n\n            return true;\n          }\n\n          if (node instanceof AST_Symbol || node instanceof AST_PropAccess) {\n            var name = node.print_to_string();\n            options[name] = true;\n            return true;\n          }\n\n          if (!(node instanceof AST_Sequence)) throw node;\n\n          function to_string(value) {\n            return value instanceof AST_Constant ? value.getValue() : value.print_to_string({\n              quote_keys: true\n            });\n          }\n        });\n      } catch (ex) {\n        if (flag) {\n          fatal(\"Error parsing arguments for '\" + flag + \"': \" + value);\n        } else {\n          options[value] = null;\n        }\n      }\n\n      return options;\n    };\n  }\n\n  function symdef(def) {\n    var ret = 1e6 + def.id + \" \" + def.name;\n    if (def.mangled_name) ret += \" \" + def.mangled_name;\n    return ret;\n  }\n\n  function collect_from_map(map, callback) {\n    var result = [];\n    map.forEach(function (def) {\n      result.push(callback(def));\n    });\n    return result;\n  }\n\n  function format_object(obj) {\n    var lines = [];\n    var padding = \"\";\n    Object.keys(obj).map(function (name) {\n      if (padding.length < name.length) padding = Array(name.length + 1).join(\" \");\n      return [name, JSON.stringify(obj[name])];\n    }).forEach(function (tokens) {\n      lines.push(\"  \" + tokens[0] + padding.slice(tokens[0].length - 2) + tokens[1]);\n    });\n    return lines.join(\"\\n\");\n  }\n\n  function print_error(msg) {\n    process.stderr.write(msg);\n    process.stderr.write(\"\\n\");\n  }\n\n  function describe_ast() {\n    var out = OutputStream({\n      beautify: true\n    });\n\n    function doitem(ctor) {\n      out.print(\"AST_\" + ctor.TYPE);\n      const props = ctor.SELF_PROPS.filter(prop => !/^\\$/.test(prop));\n\n      if (props.length > 0) {\n        out.space();\n        out.with_parens(function () {\n          props.forEach(function (prop, i) {\n            if (i) out.space();\n            out.print(prop);\n          });\n        });\n      }\n\n      if (ctor.documentation) {\n        out.space();\n        out.print_string(ctor.documentation);\n      }\n\n      if (ctor.SUBCLASSES.length > 0) {\n        out.space();\n        out.with_block(function () {\n          ctor.SUBCLASSES.forEach(function (ctor) {\n            out.indent();\n            doitem(ctor);\n            out.newline();\n          });\n        });\n      }\n    }\n\n    doitem(AST_Node);\n    return out + \"\\n\";\n  }\n}","map":{"version":3,"sources":["/Users/bruceseymour/ra-video/client/node_modules/@ampproject/toolbox-optimizer/node_modules/terser/lib/cli.js"],"names":["minify","_default_options","parse","AST_Assign","AST_Array","AST_Constant","AST_Node","AST_PropAccess","AST_RegExp","AST_Sequence","AST_Symbol","AST_Token","walk","OutputStream","run_cli","program","packageJson","fs","path","skip_keys","Set","files","options","compress","mangle","default_options","version","name","parseArgv","undefined","process","argv","includes","helpInformation","describe_ast","text","option","push","format_object","join","parse_js","arguments","configFile","JSON","read_file","output","sourceMap","url","fatal","forEach","ecma","beautify","format","comments","define","global_defs","expr","keepClassnames","keep_classnames","keepFnames","keep_fnames","mangleProps","domprops","Array","isArray","reserved","properties","nameCache","ast","code","acorn","spidermonkey","content","rawArgs","indexOf","rename","convert_path","base","relative","filesList","length","args","simple_glob","Promise","resolve","chunks","stdin","setEncoding","on","chunk","resume","convert_ast","fn","from_mozilla_ast","Object","keys","reduce","timings","toplevel","require","ecmaVersion","locations","sourceFile","sourceType","module","obj","body","concat","ex","result","print_error","filename","line","col","lines","split","limit","slice","replace","defs","figure_out_scope","console","log","stringify","key","value","symdef","map","size","collect_from_map","has","Map","_class","TYPE","block_scope","variables","functions","enclosed","CTOR","PROPS","prop","minified","to_mozilla_ast","writeFileSync","phase","toFixed","message","Error","stack","exit","glob","apply","match","dir","dirname","entries","readdirSync","pattern","basename","mod","platform","rx","RegExp","results","filter","test","default_value","readFileSync","flag","expression","node","left","print_to_string","right","elements","to_string","source","flags","getValue","quote_keys","def","ret","id","mangled_name","callback","padding","tokens","msg","stderr","write","out","doitem","ctor","print","props","SELF_PROPS","space","with_parens","i","documentation","print_string","SUBCLASSES","with_block","indent","newline"],"mappings":"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","sourcesContent":["import { minify, _default_options } from \"../main.js\";\nimport { parse } from \"./parse.js\";\nimport {\n    AST_Assign,\n    AST_Array,\n    AST_Constant,\n    AST_Node,\n    AST_PropAccess,\n    AST_RegExp,\n    AST_Sequence,\n    AST_Symbol,\n    AST_Token,\n    walk\n} from \"./ast.js\";\nimport { OutputStream } from \"./output.js\";\n\nexport async function run_cli({ program, packageJson, fs, path }) {\n    const skip_keys = new Set([ \"cname\", \"parent_scope\", \"scope\", \"uses_eval\", \"uses_with\" ]);\n    var files = {};\n    var options = {\n        compress: false,\n        mangle: false\n    };\n    const default_options = await _default_options();\n    program.version(packageJson.name + \" \" + packageJson.version);\n    program.parseArgv = program.parse;\n    program.parse = undefined;\n\n    if (process.argv.includes(\"ast\")) program.helpInformation = describe_ast;\n    else if (process.argv.includes(\"options\")) program.helpInformation = function() {\n        var text = [];\n        for (var option in default_options) {\n            text.push(\"--\" + (option === \"sourceMap\" ? \"source-map\" : option) + \" options:\");\n            text.push(format_object(default_options[option]));\n            text.push(\"\");\n        }\n        return text.join(\"\\n\");\n    };\n\n    program.option(\"-p, --parse <options>\", \"Specify parser options.\", parse_js());\n    program.option(\"-c, --compress [options]\", \"Enable compressor/specify compressor options.\", parse_js());\n    program.option(\"-m, --mangle [options]\", \"Mangle names/specify mangler options.\", parse_js());\n    program.option(\"--mangle-props [options]\", \"Mangle properties/specify mangler options.\", parse_js());\n    program.option(\"-f, --format [options]\", \"Format options.\", parse_js());\n    program.option(\"-b, --beautify [options]\", \"Alias for --format beautify=true.\", parse_js());\n    program.option(\"-o, --output <file>\", \"Output file (default STDOUT).\");\n    program.option(\"--comments [filter]\", \"Preserve copyright comments in the output.\");\n    program.option(\"--config-file <file>\", \"Read minify() options from JSON file.\");\n    program.option(\"-d, --define <expr>[=value]\", \"Global definitions.\", parse_js(\"define\"));\n    program.option(\"--ecma <version>\", \"Specify ECMAScript release: 5, 2015, 2016 or 2017...\");\n    program.option(\"-e, --enclose [arg[,...][:value[,...]]]\", \"Embed output in a big function with configurable arguments and values.\");\n    program.option(\"--ie8\", \"Support non-standard Internet Explorer 8.\");\n    program.option(\"--keep-classnames\", \"Do not mangle/drop class names.\");\n    program.option(\"--keep-fnames\", \"Do not mangle/drop function names. Useful for code relying on Function.prototype.name.\");\n    program.option(\"--module\", \"Input is an ES6 module\");\n    program.option(\"--name-cache <file>\", \"File to hold mangled name mappings.\");\n    program.option(\"--rename\", \"Force symbol expansion.\");\n    program.option(\"--no-rename\", \"Disable symbol expansion.\");\n    program.option(\"--safari10\", \"Support non-standard Safari 10.\");\n    program.option(\"--source-map [options]\", \"Enable source map/specify source map options.\", parse_js());\n    program.option(\"--timings\", \"Display operations run time on STDERR.\");\n    program.option(\"--toplevel\", \"Compress and/or mangle variables in toplevel scope.\");\n    program.option(\"--wrap <name>\", \"Embed everything as a function with “exports” corresponding to “name” globally.\");\n    program.arguments(\"[files...]\").parseArgv(process.argv);\n    if (program.configFile) {\n        options = JSON.parse(read_file(program.configFile));\n    }\n    if (!program.output && program.sourceMap && program.sourceMap.url != \"inline\") {\n        fatal(\"ERROR: cannot write source map to STDOUT\");\n    }\n\n    [\n        \"compress\",\n        \"enclose\",\n        \"ie8\",\n        \"mangle\",\n        \"module\",\n        \"safari10\",\n        \"sourceMap\",\n        \"toplevel\",\n        \"wrap\"\n    ].forEach(function(name) {\n        if (name in program) {\n            options[name] = program[name];\n        }\n    });\n\n    if (\"ecma\" in program) {\n        if (program.ecma != (program.ecma | 0)) fatal(\"ERROR: ecma must be an integer\");\n        const ecma = program.ecma | 0;\n        if (ecma > 5 && ecma < 2015)\n            options.ecma = ecma + 2009;\n        else\n            options.ecma = ecma;\n    }\n    if (program.beautify || program.format) {\n        if (program.beautify && program.format) {\n            fatal(\"Please only specify one of --beautify or --format\");\n        }\n        if (program.beautify) {\n            options.format = typeof program.beautify == \"object\" ? program.beautify : {};\n            if (!(\"beautify\" in options.format)) {\n                options.format.beautify = true;\n            }\n        }\n        if (program.format) {\n            options.format = typeof program.format == \"object\" ? program.format : {};\n        }\n    }\n    if (program.comments) {\n        if (typeof options.format != \"object\") options.format = {};\n        options.format.comments = typeof program.comments == \"string\" ? (program.comments == \"false\" ? false : program.comments) : \"some\";\n    }\n    if (program.define) {\n        if (typeof options.compress != \"object\") options.compress = {};\n        if (typeof options.compress.global_defs != \"object\") options.compress.global_defs = {};\n        for (var expr in program.define) {\n            options.compress.global_defs[expr] = program.define[expr];\n        }\n    }\n    if (program.keepClassnames) {\n        options.keep_classnames = true;\n    }\n    if (program.keepFnames) {\n        options.keep_fnames = true;\n    }\n    if (program.mangleProps) {\n        if (program.mangleProps.domprops) {\n            delete program.mangleProps.domprops;\n        } else {\n            if (typeof program.mangleProps != \"object\") program.mangleProps = {};\n            if (!Array.isArray(program.mangleProps.reserved)) program.mangleProps.reserved = [];\n        }\n        if (typeof options.mangle != \"object\") options.mangle = {};\n        options.mangle.properties = program.mangleProps;\n    }\n    if (program.nameCache) {\n        options.nameCache = JSON.parse(read_file(program.nameCache, \"{}\"));\n    }\n    if (program.output == \"ast\") {\n        options.format = {\n            ast: true,\n            code: false\n        };\n    }\n    if (program.parse) {\n        if (!program.parse.acorn && !program.parse.spidermonkey) {\n            options.parse = program.parse;\n        } else if (program.sourceMap && program.sourceMap.content == \"inline\") {\n            fatal(\"ERROR: inline source map only works with built-in parser\");\n        }\n    }\n    if (~program.rawArgs.indexOf(\"--rename\")) {\n        options.rename = true;\n    } else if (!program.rename) {\n        options.rename = false;\n    }\n\n    let convert_path = name => name;\n    if (typeof program.sourceMap == \"object\" && \"base\" in program.sourceMap) {\n        convert_path = function() {\n            var base = program.sourceMap.base;\n            delete options.sourceMap.base;\n            return function(name) {\n                return path.relative(base, name);\n            };\n        }();\n    }\n\n    let filesList;\n    if (options.files && options.files.length) {\n        filesList = options.files;\n\n        delete options.files;\n    } else if (program.args.length) {\n        filesList = program.args;\n    }\n\n    if (filesList) {\n        simple_glob(filesList).forEach(function(name) {\n            files[convert_path(name)] = read_file(name);\n        });\n    } else {\n        await new Promise((resolve) => {\n            var chunks = [];\n            process.stdin.setEncoding(\"utf8\");\n            process.stdin.on(\"data\", function(chunk) {\n                chunks.push(chunk);\n            }).on(\"end\", function() {\n                files = [ chunks.join(\"\") ];\n                resolve();\n            });\n            process.stdin.resume();\n        });\n    }\n\n    await run_cli();\n\n    function convert_ast(fn) {\n        return AST_Node.from_mozilla_ast(Object.keys(files).reduce(fn, null));\n    }\n\n    async function run_cli() {\n        var content = program.sourceMap && program.sourceMap.content;\n        if (content && content !== \"inline\") {\n            options.sourceMap.content = read_file(content, content);\n        }\n        if (program.timings) options.timings = true;\n\n        try {\n            if (program.parse) {\n                if (program.parse.acorn) {\n                    files = convert_ast(function(toplevel, name) {\n                        return require(\"acorn\").parse(files[name], {\n                            ecmaVersion: 2018,\n                            locations: true,\n                            program: toplevel,\n                            sourceFile: name,\n                            sourceType: options.module || program.parse.module ? \"module\" : \"script\"\n                        });\n                    });\n                } else if (program.parse.spidermonkey) {\n                    files = convert_ast(function(toplevel, name) {\n                        var obj = JSON.parse(files[name]);\n                        if (!toplevel) return obj;\n                        toplevel.body = toplevel.body.concat(obj.body);\n                        return toplevel;\n                    });\n                }\n            }\n        } catch (ex) {\n            fatal(ex);\n        }\n\n        let result;\n        try {\n            result = await minify(files, options);\n        } catch (ex) {\n            if (ex.name == \"SyntaxError\") {\n                print_error(\"Parse error at \" + ex.filename + \":\" + ex.line + \",\" + ex.col);\n                var col = ex.col;\n                var lines = files[ex.filename].split(/\\r?\\n/);\n                var line = lines[ex.line - 1];\n                if (!line && !col) {\n                    line = lines[ex.line - 2];\n                    col = line.length;\n                }\n                if (line) {\n                    var limit = 70;\n                    if (col > limit) {\n                        line = line.slice(col - limit);\n                        col = limit;\n                    }\n                    print_error(line.slice(0, 80));\n                    print_error(line.slice(0, col).replace(/\\S/g, \" \") + \"^\");\n                }\n            }\n            if (ex.defs) {\n                print_error(\"Supported options:\");\n                print_error(format_object(ex.defs));\n            }\n            fatal(ex);\n            return;\n        }\n\n        if (program.output == \"ast\") {\n            if (!options.compress && !options.mangle) {\n                result.ast.figure_out_scope({});\n            }\n            console.log(JSON.stringify(result.ast, function(key, value) {\n                if (value) switch (key) {\n                  case \"thedef\":\n                    return symdef(value);\n                  case \"enclosed\":\n                    return value.length ? value.map(symdef) : undefined;\n                  case \"variables\":\n                  case \"functions\":\n                  case \"globals\":\n                    return value.size ? collect_from_map(value, symdef) : undefined;\n                }\n                if (skip_keys.has(key)) return;\n                if (value instanceof AST_Token) return;\n                if (value instanceof Map) return;\n                if (value instanceof AST_Node) {\n                    var result = {\n                        _class: \"AST_\" + value.TYPE\n                    };\n                    if (value.block_scope) {\n                        result.variables = value.block_scope.variables;\n                        result.functions = value.block_scope.functions;\n                        result.enclosed = value.block_scope.enclosed;\n                    }\n                    value.CTOR.PROPS.forEach(function(prop) {\n                        result[prop] = value[prop];\n                    });\n                    return result;\n                }\n                return value;\n            }, 2));\n        } else if (program.output == \"spidermonkey\") {\n            try {\n                const minified = await minify(result.code, {\n                    compress: false,\n                    mangle: false,\n                    format: {\n                        ast: true,\n                        code: false\n                    }\n                });\n                console.log(JSON.stringify(minified.ast.to_mozilla_ast(), null, 2));\n            } catch (ex) {\n                fatal(ex);\n                return;\n            }\n        } else if (program.output) {\n            fs.writeFileSync(program.output, result.code);\n            if (options.sourceMap && options.sourceMap.url !== \"inline\" && result.map) {\n                fs.writeFileSync(program.output + \".map\", result.map);\n            }\n        } else {\n            console.log(result.code);\n        }\n        if (program.nameCache) {\n            fs.writeFileSync(program.nameCache, JSON.stringify(options.nameCache));\n        }\n        if (result.timings) for (var phase in result.timings) {\n            print_error(\"- \" + phase + \": \" + result.timings[phase].toFixed(3) + \"s\");\n        }\n    }\n\n    function fatal(message) {\n        if (message instanceof Error) message = message.stack.replace(/^\\S*?Error:/, \"ERROR:\");\n        print_error(message);\n        process.exit(1);\n    }\n\n    // A file glob function that only supports \"*\" and \"?\" wildcards in the basename.\n    // Example: \"foo/bar/*baz??.*.js\"\n    // Argument `glob` may be a string or an array of strings.\n    // Returns an array of strings. Garbage in, garbage out.\n    function simple_glob(glob) {\n        if (Array.isArray(glob)) {\n            return [].concat.apply([], glob.map(simple_glob));\n        }\n        if (glob && glob.match(/[*?]/)) {\n            var dir = path.dirname(glob);\n            try {\n                var entries = fs.readdirSync(dir);\n            } catch (ex) {}\n            if (entries) {\n                var pattern = \"^\" + path.basename(glob)\n                    .replace(/[.+^$[\\]\\\\(){}]/g, \"\\\\$&\")\n                    .replace(/\\*/g, \"[^/\\\\\\\\]*\")\n                    .replace(/\\?/g, \"[^/\\\\\\\\]\") + \"$\";\n                var mod = process.platform === \"win32\" ? \"i\" : \"\";\n                var rx = new RegExp(pattern, mod);\n                var results = entries.filter(function(name) {\n                    return rx.test(name);\n                }).map(function(name) {\n                    return path.join(dir, name);\n                });\n                if (results.length) return results;\n            }\n        }\n        return [ glob ];\n    }\n\n    function read_file(path, default_value) {\n        try {\n            return fs.readFileSync(path, \"utf8\");\n        } catch (ex) {\n            if ((ex.code == \"ENOENT\" || ex.code == \"ENAMETOOLONG\") && default_value != null) return default_value;\n            fatal(ex);\n        }\n    }\n\n    function parse_js(flag) {\n        return function(value, options) {\n            options = options || {};\n            try {\n                walk(parse(value, { expression: true }), node => {\n                    if (node instanceof AST_Assign) {\n                        var name = node.left.print_to_string();\n                        var value = node.right;\n                        if (flag) {\n                            options[name] = value;\n                        } else if (value instanceof AST_Array) {\n                            options[name] = value.elements.map(to_string);\n                        } else if (value instanceof AST_RegExp) {\n                            value = value.value;\n                            options[name] = new RegExp(value.source, value.flags);\n                        } else {\n                            options[name] = to_string(value);\n                        }\n                        return true;\n                    }\n                    if (node instanceof AST_Symbol || node instanceof AST_PropAccess) {\n                        var name = node.print_to_string();\n                        options[name] = true;\n                        return true;\n                    }\n                    if (!(node instanceof AST_Sequence)) throw node;\n\n                    function to_string(value) {\n                        return value instanceof AST_Constant ? value.getValue() : value.print_to_string({\n                            quote_keys: true\n                        });\n                    }\n                });\n            } catch(ex) {\n                if (flag) {\n                    fatal(\"Error parsing arguments for '\" + flag + \"': \" + value);\n                } else {\n                    options[value] = null;\n                }\n            }\n            return options;\n        };\n    }\n\n    function symdef(def) {\n        var ret = (1e6 + def.id) + \" \" + def.name;\n        if (def.mangled_name) ret += \" \" + def.mangled_name;\n        return ret;\n    }\n\n    function collect_from_map(map, callback) {\n        var result = [];\n        map.forEach(function (def) {\n            result.push(callback(def));\n        });\n        return result;\n    }\n\n    function format_object(obj) {\n        var lines = [];\n        var padding = \"\";\n        Object.keys(obj).map(function(name) {\n            if (padding.length < name.length) padding = Array(name.length + 1).join(\" \");\n            return [ name, JSON.stringify(obj[name]) ];\n        }).forEach(function(tokens) {\n            lines.push(\"  \" + tokens[0] + padding.slice(tokens[0].length - 2) + tokens[1]);\n        });\n        return lines.join(\"\\n\");\n    }\n\n    function print_error(msg) {\n        process.stderr.write(msg);\n        process.stderr.write(\"\\n\");\n    }\n\n    function describe_ast() {\n        var out = OutputStream({ beautify: true });\n        function doitem(ctor) {\n            out.print(\"AST_\" + ctor.TYPE);\n            const props = ctor.SELF_PROPS.filter(prop => !/^\\$/.test(prop));\n\n            if (props.length > 0) {\n                out.space();\n                out.with_parens(function() {\n                    props.forEach(function(prop, i) {\n                        if (i) out.space();\n                        out.print(prop);\n                    });\n                });\n            }\n\n            if (ctor.documentation) {\n                out.space();\n                out.print_string(ctor.documentation);\n            }\n\n            if (ctor.SUBCLASSES.length > 0) {\n                out.space();\n                out.with_block(function() {\n                    ctor.SUBCLASSES.forEach(function(ctor) {\n                        out.indent();\n                        doitem(ctor);\n                        out.newline();\n                    });\n                });\n            }\n        }\n        doitem(AST_Node);\n        return out + \"\\n\";\n    }\n}\n"]},"metadata":{},"sourceType":"module"}