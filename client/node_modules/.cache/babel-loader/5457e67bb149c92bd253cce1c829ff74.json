{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.interopDefault = interopDefault;\nexports.loadComponents = loadComponents;\n\nvar _constants = require(\"../lib/constants\");\n\nvar _path = require(\"path\");\n\nvar _require = require(\"./require\");\n\nfunction interopDefault(mod) {\n  return mod.default || mod;\n}\n\nasync function loadComponents(distDir, pathname, serverless) {\n  if (serverless) {\n    const Component = await (0, _require.requirePage)(pathname, distDir, serverless);\n    let {\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps\n    } = Component;\n    getStaticProps = await getStaticProps;\n    getStaticPaths = await getStaticPaths;\n    getServerSideProps = await getServerSideProps;\n    const pageConfig = (await Component.config) || {};\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps\n    };\n  }\n\n  const [DocumentMod, AppMod, ComponentMod] = await Promise.all([(0, _require.requirePage)('/_document', distDir, serverless), (0, _require.requirePage)('/_app', distDir, serverless), (0, _require.requirePage)(pathname, distDir, serverless)]);\n  const [buildManifest, reactLoadableManifest, Component, Document, App] = await Promise.all([require((0, _path.join)(distDir, _constants.BUILD_MANIFEST)), require((0, _path.join)(distDir, _constants.REACT_LOADABLE_MANIFEST)), interopDefault(ComponentMod), interopDefault(DocumentMod), interopDefault(AppMod)]);\n  const {\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths\n  } = ComponentMod;\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths\n  };\n}","map":{"version":3,"sources":["../../../next-server/server/load-components.ts"],"names":["mod","Component","getStaticProps","getStaticPaths","getServerSideProps","pageConfig","Promise","require","BUILD_MANIFEST","REACT_LOADABLE_MANIFEST","interopDefault","ComponentMod"],"mappings":";;;;;;AAAA,IAAA,UAAA,GAAA,OAAA,CAAA,kBAAA,CAAA;;AACA,IAAA,KAAA,GAAA,OAAA,CAAA,MAAA,CAAA;;AACA,IAAA,QAAA,GAAA,OAAA,CAAA,WAAA,CAAA;;AAUO,SAAA,cAAA,CAAA,GAAA,EAAkC;AACvC,SAAOA,GAAG,CAAHA,OAAAA,IAAP,GAAA;AAuBK;;AAAA,eAAA,cAAA,CAAA,OAAA,EAAA,QAAA,EAAA,UAAA,EAI8B;AACnC,MAAA,UAAA,EAAgB;AACd,UAAMC,SAAS,GAAG,MAAM,CAAA,GAAA,QAAA,CAAA,WAAA,EAAA,QAAA,EAAA,OAAA,EAAxB,UAAwB,CAAxB;AACA,QAAI;AAAA,MAAA,cAAA;AAAA,MAAA,cAAA;AAAA,MAAA;AAAA,QAAJ,SAAA;AAEAC,IAAAA,cAAc,GAAG,MAAjBA,cAAAA;AACAC,IAAAA,cAAc,GAAG,MAAjBA,cAAAA;AACAC,IAAAA,kBAAkB,GAAG,MAArBA,kBAAAA;AACA,UAAMC,UAAU,GAAG,CAAC,MAAMJ,SAAS,CAAhB,MAAA,KAAnB,EAAA;AAEA,WAAO;AAAA,MAAA,SAAA;AAAA,MAAA,UAAA;AAAA,MAAA,cAAA;AAAA,MAAA,cAAA;AAAP,MAAA;AAAO,KAAP;AASF;;AAAA,QAAM,CAAA,WAAA,EAAA,MAAA,EAAA,YAAA,IAAsC,MAAMK,OAAO,CAAPA,GAAAA,CAAY,CAC5D,CAAA,GAAA,QAAA,CAAA,WAAA,EAAA,YAAA,EAAA,OAAA,EAD4D,UAC5D,CAD4D,EAE5D,CAAA,GAAA,QAAA,CAAA,WAAA,EAAA,OAAA,EAAA,OAAA,EAF4D,UAE5D,CAF4D,EAG5D,CAAA,GAAA,QAAA,CAAA,WAAA,EAAA,QAAA,EAAA,OAAA,EAHF,UAGE,CAH4D,CAAZA,CAAlD;AAMA,QAAM,CAAA,aAAA,EAAA,qBAAA,EAAA,SAAA,EAAA,QAAA,EAAA,GAAA,IAMF,MAAMA,OAAO,CAAPA,GAAAA,CAAY,CACpBC,OAAO,CAAC,CAAA,GAAA,KAAA,CAAA,IAAA,EAAA,OAAA,EAAcC,UAAAA,CADF,cACZ,CAAD,CADa,EAEpBD,OAAO,CAAC,CAAA,GAAA,KAAA,CAAA,IAAA,EAAA,OAAA,EAAcE,UAAAA,CAFF,uBAEZ,CAAD,CAFa,EAGpBC,cAAc,CAHM,YAGN,CAHM,EAIpBA,cAAc,CAJM,WAIN,CAJM,EAKpBA,cAAc,CAXhB,MAWgB,CALM,CAAZJ,CANV;AAcA,QAAM;AAAA,IAAA,kBAAA;AAAA,IAAA,cAAA;AAAA,IAAA;AAAA,MAAN,YAAA;AAEA,SAAO;AAAA,IAAA,GAAA;AAAA,IAAA,QAAA;AAAA,IAAA,SAAA;AAAA,IAAA,aAAA;AAAA,IAAA,qBAAA;AAMLD,IAAAA,UAAU,EAAEM,YAAY,CAAZA,MAAAA,IANP,EAAA;AAAA,IAAA,kBAAA;AAAA,IAAA,cAAA;AAAP,IAAA;AAAO,GAAP;AAWD","sourcesContent":["import { BUILD_MANIFEST, REACT_LOADABLE_MANIFEST } from '../lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../lib/utils'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport function interopDefault(mod: any) {\n  return mod.default || mod\n}\n\nexport type ManifestItem = {\n  id: number | string\n  name: string\n  file: string\n}\n\ntype ReactLoadableManifest = { [moduleId: string]: ManifestItem[] }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig?: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n}\n\nexport async function loadComponents(\n  distDir: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const Component = await requirePage(pathname, distDir, serverless)\n    let { getStaticProps, getStaticPaths, getServerSideProps } = Component\n\n    getStaticProps = await getStaticProps\n    getStaticPaths = await getStaticPaths\n    getServerSideProps = await getServerSideProps\n    const pageConfig = (await Component.config) || {}\n\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n    } as LoadComponentsReturnType\n  }\n\n  const [DocumentMod, AppMod, ComponentMod] = await Promise.all([\n    requirePage('/_document', distDir, serverless),\n    requirePage('/_app', distDir, serverless),\n    requirePage(pathname, distDir, serverless),\n  ])\n\n  const [\n    buildManifest,\n    reactLoadableManifest,\n    Component,\n    Document,\n    App,\n  ] = await Promise.all([\n    require(join(distDir, BUILD_MANIFEST)),\n    require(join(distDir, REACT_LOADABLE_MANIFEST)),\n    interopDefault(ComponentMod),\n    interopDefault(DocumentMod),\n    interopDefault(AppMod),\n  ])\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"]},"metadata":{},"sourceType":"script"}