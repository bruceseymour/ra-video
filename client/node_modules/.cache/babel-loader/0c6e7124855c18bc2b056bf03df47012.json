{"ast":null,"code":"/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nconst {\n  appendChild,\n  appendAll,\n  hasAttribute,\n  firstChildByTag\n} = require('../NodeUtils');\n\nconst {\n  isRenderDelayingExtension\n} = require('../Extensions.js');\n\nclass HeadNodes {\n  constructor() {\n    this._styleAmpRuntime = null;\n    this._linkStyleAmpRuntime = null;\n    this._metaCharset = null;\n    this._scriptAmpEngine = null;\n    this._metaOther = [];\n    this._scriptRenderDelayingExtensions = [];\n    this._scriptNonRenderDelayingExtensions = [];\n    this._resourceHintLinks = [];\n    this._linkIcons = [];\n    this._styleAmpCustom = null;\n    this._linkStylesheetsBeforeAmpCustom = [];\n    this._others = [];\n    this._styleAmpBoilerplate = null;\n    this._noscript = null;\n  }\n\n  register(nodes) {\n    nodes.forEach(this._registerNode.bind(this));\n  }\n\n  uniquifyAndSortCustomElements() {\n    this._scriptRenderDelayingExtensions = this._removeDuplicateCustomExtensions(this._scriptRenderDelayingExtensions);\n    this._scriptNonRenderDelayingExtensions = this._removeDuplicateCustomExtensions(this._scriptNonRenderDelayingExtensions);\n  }\n\n  _removeDuplicateCustomExtensions(extensions) {\n    const nodesByName = new Map();\n\n    for (const node of extensions) {\n      const name = this._getName(node);\n\n      nodesByName.set(name, node);\n    }\n\n    return Array.from(nodesByName.values());\n  }\n\n  appendToHead(head) {\n    appendChild(head, this._metaCharset);\n    appendChild(head, this._linkStyleAmpRuntime);\n    appendChild(head, this._styleAmpRuntime);\n    appendAll(head, this._metaOther);\n    appendChild(head, this._scriptAmpEngine);\n    appendAll(head, this._scriptRenderDelayingExtensions);\n    appendAll(head, this._scriptNonRenderDelayingExtensions);\n    appendAll(head, this._linkIcons);\n    appendAll(head, this._resourceHintLinks);\n    appendAll(head, this._linkStylesheetsBeforeAmpCustom);\n    appendChild(head, this._styleAmpCustom);\n    appendAll(head, this._others);\n    appendChild(head, this._styleAmpBoilerplate);\n    appendChild(head, this._noscript);\n  }\n\n  _registerNode(node) {\n    if (node.tagName === 'meta') {\n      this._registerMeta(node);\n    } else if (node.tagName === 'script') {\n      this._registerScript(node);\n    } else if (node.tagName === 'style') {\n      this._registerStyle(node);\n    } else if (node.tagName === 'link') {\n      this._registerLink(node);\n    } else if (node.tagName === 'noscript') {\n      this._noscript = node;\n    } else if (node.tagName) {\n      this._others.push(node);\n    }\n  }\n\n  _registerMeta(node) {\n    if (node.attribs.charset) {\n      this._metaCharset = node;\n      return;\n    }\n\n    this._metaOther.push(node);\n  }\n\n  _registerScript(node) {\n    // Currently there are two amp engine tags: v0.js and\n    // amp4ads-v0.js.  According to validation rules they are the\n    // only script tags with a src attribute and do not have\n    // attributes custom-element or custom-template. Record the\n    // amp engine tag so it can be emitted first among script\n    // tags.\n    if (hasAttribute(node, 'src') && !this._getName(node)) {\n      this._scriptAmpEngine = node;\n      return;\n    }\n\n    if (hasAttribute(node, 'custom-element')) {\n      if (isRenderDelayingExtension(node)) {\n        this._scriptRenderDelayingExtensions.push(node);\n\n        return;\n      }\n\n      this._scriptNonRenderDelayingExtensions.push(node);\n\n      return;\n    }\n\n    if (hasAttribute(node, 'custom-template')) {\n      this._scriptNonRenderDelayingExtensions.push(node);\n\n      return;\n    }\n\n    this._others.push(node);\n  }\n\n  _registerStyle(node) {\n    if (hasAttribute(node, 'amp-runtime')) {\n      this._styleAmpRuntime = node;\n      return;\n    }\n\n    if (hasAttribute('node, amp-custom')) {\n      this._styleAmpCustom = node;\n      return;\n    }\n\n    if (hasAttribute(node, 'amp-boilerplate') || hasAttribute(node, 'amp4ads-boilerplate')) {\n      this._styleAmpBoilerplate = node;\n      return;\n    }\n\n    this._others.push(node);\n  }\n\n  _registerLink(node) {\n    const rel = node.attribs.rel;\n\n    if (rel === 'stylesheet') {\n      if (node.attribs.href.endsWith('/v0.css')) {\n        this._linkStyleAmpRuntime = node;\n        return;\n      }\n\n      if (!this._styleAmpCustom) {\n        // We haven't seen amp-custom yet.\n        this._linkStylesheetsBeforeAmpCustom.push(node);\n\n        return;\n      }\n    }\n\n    if (rel === 'icon' || rel === 'shortcut icon' || rel === 'icon shortcut') {\n      this._linkIcons.push(node);\n\n      return;\n    }\n\n    if (rel === 'preload' || rel === 'prefetch' || rel === 'dns-prefetch' || rel === 'preconnect') {\n      this._resourceHintLinks.push(node);\n\n      return;\n    }\n\n    this._others.push(node);\n  }\n\n  _getName(node) {\n    return node.attribs['custom-element'] || node.attribs['custom-template'];\n  }\n\n}\n/**\n * ReorderHead reorders the children of <head>. Specifically, it\n * orders the <head> like so:\n * (0) <meta charset> tag\n * (1) <style amp-runtime> (inserted by ampruntimecss.go)\n * (2) remaining <meta> tags (those other than <meta charset>)\n * (3) AMP runtime .js <script> tag\n * (4) <script> tags that are render delaying\n * (5) <script> tags for remaining extensions\n * (6) <link> tag for favicons\n * (7) <link> tag for resource hints\n * (8) <link rel=stylesheet> tags before <style amp-custom>\n * (9) <style amp-custom>\n * (10) any other tags allowed in <head>\n * (11) AMP boilerplate (first style amp-boilerplate, then noscript)\n */\n\n\nclass ReorderHeadTransformer {\n  transform(tree) {\n    const html = firstChildByTag(tree, 'html');\n\n    if (!html) {\n      return;\n    }\n\n    const head = firstChildByTag(html, 'head');\n\n    if (!head) {\n      return;\n    }\n\n    if (!head.children) {\n      return;\n    }\n\n    const headNodes = new HeadNodes();\n    headNodes.register(head.children);\n    headNodes.uniquifyAndSortCustomElements();\n    head.children = [];\n    headNodes.appendToHead(head);\n  }\n\n}\n\nmodule.exports = ReorderHeadTransformer;","map":{"version":3,"sources":["/Users/bruceseymour/ra-video/client/node_modules/@ampproject/toolbox-optimizer/lib/transformers/ReorderHeadTransformer.js"],"names":["appendChild","appendAll","hasAttribute","firstChildByTag","require","isRenderDelayingExtension","HeadNodes","constructor","_styleAmpRuntime","_linkStyleAmpRuntime","_metaCharset","_scriptAmpEngine","_metaOther","_scriptRenderDelayingExtensions","_scriptNonRenderDelayingExtensions","_resourceHintLinks","_linkIcons","_styleAmpCustom","_linkStylesheetsBeforeAmpCustom","_others","_styleAmpBoilerplate","_noscript","register","nodes","forEach","_registerNode","bind","uniquifyAndSortCustomElements","_removeDuplicateCustomExtensions","extensions","nodesByName","Map","node","name","_getName","set","Array","from","values","appendToHead","head","tagName","_registerMeta","_registerScript","_registerStyle","_registerLink","push","attribs","charset","rel","href","endsWith","ReorderHeadTransformer","transform","tree","html","children","headNodes","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nconst {appendChild, appendAll, hasAttribute, firstChildByTag} = require('../NodeUtils');\nconst {isRenderDelayingExtension} = require('../Extensions.js');\n\nclass HeadNodes {\n  constructor() {\n    this._styleAmpRuntime = null;\n    this._linkStyleAmpRuntime = null;\n    this._metaCharset = null;\n    this._scriptAmpEngine = null;\n    this._metaOther = [];\n    this._scriptRenderDelayingExtensions = [];\n    this._scriptNonRenderDelayingExtensions = [];\n    this._resourceHintLinks = [];\n    this._linkIcons = [];\n    this._styleAmpCustom = null;\n    this._linkStylesheetsBeforeAmpCustom = [];\n    this._others = [];\n    this._styleAmpBoilerplate = null;\n    this._noscript = null;\n  }\n\n  register(nodes) {\n    nodes.forEach(this._registerNode.bind(this));\n  }\n\n  uniquifyAndSortCustomElements() {\n    this._scriptRenderDelayingExtensions = this._removeDuplicateCustomExtensions(\n      this._scriptRenderDelayingExtensions\n    );\n    this._scriptNonRenderDelayingExtensions = this._removeDuplicateCustomExtensions(\n      this._scriptNonRenderDelayingExtensions\n    );\n  }\n\n  _removeDuplicateCustomExtensions(extensions) {\n    const nodesByName = new Map();\n    for (const node of extensions) {\n      const name = this._getName(node);\n      nodesByName.set(name, node);\n    }\n    return Array.from(nodesByName.values());\n  }\n\n  appendToHead(head) {\n    appendChild(head, this._metaCharset);\n    appendChild(head, this._linkStyleAmpRuntime);\n    appendChild(head, this._styleAmpRuntime);\n    appendAll(head, this._metaOther);\n    appendChild(head, this._scriptAmpEngine);\n    appendAll(head, this._scriptRenderDelayingExtensions);\n    appendAll(head, this._scriptNonRenderDelayingExtensions);\n    appendAll(head, this._linkIcons);\n    appendAll(head, this._resourceHintLinks);\n    appendAll(head, this._linkStylesheetsBeforeAmpCustom);\n    appendChild(head, this._styleAmpCustom);\n    appendAll(head, this._others);\n    appendChild(head, this._styleAmpBoilerplate);\n    appendChild(head, this._noscript);\n  }\n\n  _registerNode(node) {\n    if (node.tagName === 'meta') {\n      this._registerMeta(node);\n    } else if (node.tagName === 'script') {\n      this._registerScript(node);\n    } else if (node.tagName === 'style') {\n      this._registerStyle(node);\n    } else if (node.tagName === 'link') {\n      this._registerLink(node);\n    } else if (node.tagName === 'noscript') {\n      this._noscript = node;\n    } else if (node.tagName) {\n      this._others.push(node);\n    }\n  }\n\n  _registerMeta(node) {\n    if (node.attribs.charset) {\n      this._metaCharset = node;\n      return;\n    }\n    this._metaOther.push(node);\n  }\n\n  _registerScript(node) {\n    // Currently there are two amp engine tags: v0.js and\n    // amp4ads-v0.js.  According to validation rules they are the\n    // only script tags with a src attribute and do not have\n    // attributes custom-element or custom-template. Record the\n    // amp engine tag so it can be emitted first among script\n    // tags.\n    if (hasAttribute(node, 'src') && !this._getName(node)) {\n      this._scriptAmpEngine = node;\n      return;\n    }\n    if (hasAttribute(node, 'custom-element')) {\n      if (isRenderDelayingExtension(node)) {\n        this._scriptRenderDelayingExtensions.push(node);\n        return;\n      }\n      this._scriptNonRenderDelayingExtensions.push(node);\n      return;\n    }\n    if (hasAttribute(node, 'custom-template')) {\n      this._scriptNonRenderDelayingExtensions.push(node);\n      return;\n    }\n    this._others.push(node);\n  }\n\n  _registerStyle(node) {\n    if (hasAttribute(node, 'amp-runtime')) {\n      this._styleAmpRuntime = node;\n      return;\n    }\n    if (hasAttribute('node, amp-custom')) {\n      this._styleAmpCustom = node;\n      return;\n    }\n    if (hasAttribute(node, 'amp-boilerplate') || hasAttribute(node, 'amp4ads-boilerplate')) {\n      this._styleAmpBoilerplate = node;\n      return;\n    }\n    this._others.push(node);\n  }\n\n  _registerLink(node) {\n    const rel = node.attribs.rel;\n    if (rel === 'stylesheet') {\n      if (node.attribs.href.endsWith('/v0.css')) {\n        this._linkStyleAmpRuntime = node;\n        return;\n      }\n      if (!this._styleAmpCustom) {\n        // We haven't seen amp-custom yet.\n        this._linkStylesheetsBeforeAmpCustom.push(node);\n        return;\n      }\n    }\n\n    if (rel === 'icon' || rel === 'shortcut icon' || rel === 'icon shortcut') {\n      this._linkIcons.push(node);\n      return;\n    }\n\n    if (rel === 'preload' || rel === 'prefetch' || rel === 'dns-prefetch' || rel === 'preconnect') {\n      this._resourceHintLinks.push(node);\n      return;\n    }\n\n    this._others.push(node);\n  }\n\n  _getName(node) {\n    return node.attribs['custom-element'] || node.attribs['custom-template'];\n  }\n}\n\n/**\n * ReorderHead reorders the children of <head>. Specifically, it\n * orders the <head> like so:\n * (0) <meta charset> tag\n * (1) <style amp-runtime> (inserted by ampruntimecss.go)\n * (2) remaining <meta> tags (those other than <meta charset>)\n * (3) AMP runtime .js <script> tag\n * (4) <script> tags that are render delaying\n * (5) <script> tags for remaining extensions\n * (6) <link> tag for favicons\n * (7) <link> tag for resource hints\n * (8) <link rel=stylesheet> tags before <style amp-custom>\n * (9) <style amp-custom>\n * (10) any other tags allowed in <head>\n * (11) AMP boilerplate (first style amp-boilerplate, then noscript)\n */\nclass ReorderHeadTransformer {\n  transform(tree) {\n    const html = firstChildByTag(tree, 'html');\n    if (!html) {\n      return;\n    }\n    const head = firstChildByTag(html, 'head');\n    if (!head) {\n      return;\n    }\n    if (!head.children) {\n      return;\n    }\n    const headNodes = new HeadNodes();\n    headNodes.register(head.children);\n    headNodes.uniquifyAndSortCustomElements();\n    head.children = [];\n    headNodes.appendToHead(head);\n  }\n}\n\nmodule.exports = ReorderHeadTransformer;\n"]},"metadata":{},"sourceType":"script"}