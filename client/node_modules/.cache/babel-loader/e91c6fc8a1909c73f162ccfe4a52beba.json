{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.attachReactRefresh = attachReactRefresh;\nexports.default = getBaseWebpackConfig;\n\nvar _codeFrame = require(\"next/dist/compiled/babel/code-frame\");\n\nvar _ReactRefreshWebpackPlugin = _interopRequireDefault(require(\"@next/react-refresh-utils/ReactRefreshWebpackPlugin\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _fs = require(\"fs\");\n\nvar _chalk = _interopRequireDefault(require(\"chalk\"));\n\nvar _semver = _interopRequireDefault(require(\"next/dist/compiled/semver\"));\n\nvar _index = _interopRequireDefault(require(\"./webpack/plugins/terser-webpack-plugin/src/index.js\"));\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _webpack = _interopRequireDefault(require(\"webpack\"));\n\nvar _constants = require(\"../lib/constants\");\n\nvar _fileExists = require(\"../lib/file-exists\");\n\nvar _getPackageVersion = require(\"../lib/get-package-version\");\n\nvar _resolveRequest = require(\"../lib/resolve-request\");\n\nvar _getTypeScriptConfiguration = require(\"../lib/typescript/getTypeScriptConfiguration\");\n\nvar _constants2 = require(\"../next-server/lib/constants\");\n\nvar _utils = require(\"../next-server/lib/utils\");\n\nvar _findPageFile = require(\"../server/lib/find-page-file\");\n\nvar Log = _interopRequireWildcard(require(\"./output/log\"));\n\nvar _collectPlugins = require(\"./plugins/collect-plugins\");\n\nvar _config = require(\"./webpack/config\");\n\nvar _overrideCssConfiguration = require(\"./webpack/config/blocks/css/overrideCssConfiguration\");\n\nvar _nextPluginLoader = require(\"./webpack/loaders/next-plugin-loader\");\n\nvar _buildManifestPlugin = _interopRequireDefault(require(\"./webpack/plugins/build-manifest-plugin\"));\n\nvar _chunkNamesPlugin = _interopRequireDefault(require(\"./webpack/plugins/chunk-names-plugin\"));\n\nvar _cssMinimizerPlugin = require(\"./webpack/plugins/css-minimizer-plugin\");\n\nvar _jsconfigPathsPlugin = require(\"./webpack/plugins/jsconfig-paths-plugin\");\n\nvar _nextDropClientPagePlugin = require(\"./webpack/plugins/next-drop-client-page-plugin\");\n\nvar _nextjsSsrImport = _interopRequireDefault(require(\"./webpack/plugins/nextjs-ssr-import\"));\n\nvar _nextjsSsrModuleCache = _interopRequireDefault(require(\"./webpack/plugins/nextjs-ssr-module-cache\"));\n\nvar _pagesManifestPlugin = _interopRequireDefault(require(\"./webpack/plugins/pages-manifest-plugin\"));\n\nvar _profilingPlugin = require(\"./webpack/plugins/profiling-plugin\");\n\nvar _reactLoadablePlugin = require(\"./webpack/plugins/react-loadable-plugin\");\n\nvar _serverlessPlugin = require(\"./webpack/plugins/serverless-plugin\");\n\nvar _webpackConformancePlugin = _interopRequireWildcard(require(\"./webpack/plugins/webpack-conformance-plugin\"));\n\nvar _wellknownErrorsPlugin = require(\"./webpack/plugins/wellknown-errors-plugin\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function () {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nconst isWebpack5 = parseInt(_webpack.default.version) === 5;\n\nif (isWebpack5 && _semver.default.lt(_webpack.default.version, '5.11.1')) {\n  Log.error(`webpack 5 version must be greater than v5.11.1 to work properly with Next.js, please upgrade to continue!\\nSee more info here: https://err.sh/next.js/invalid-webpack-5-version`);\n  process.exit(1);\n}\n\nconst devtoolRevertWarning = (0, _utils.execOnce)(devtool => {\n  console.warn(_chalk.default.yellow.bold('Warning: ') + _chalk.default.bold(`Reverting webpack devtool to '${devtool}'.\\n`) + 'Changing the webpack devtool in development mode will cause severe performance regressions.\\n' + 'Read more: https://err.sh/next.js/improper-devtool');\n});\n\nfunction parseJsonFile(filePath) {\n  const JSON5 = require('next/dist/compiled/json5');\n\n  const contents = (0, _fs.readFileSync)(filePath, 'utf8'); // Special case an empty file\n\n  if (contents.trim() === '') {\n    return {};\n  }\n\n  try {\n    return JSON5.parse(contents);\n  } catch (err) {\n    const codeFrame = (0, _codeFrame.codeFrameColumns)(String(contents), {\n      start: {\n        line: err.lineNumber,\n        column: err.columnNumber\n      }\n    }, {\n      message: err.message,\n      highlightCode: true\n    });\n    throw new Error(`Failed to parse \"${filePath}\":\\n${codeFrame}`);\n  }\n}\n\nfunction getOptimizedAliases(isServer) {\n  if (isServer) {\n    return {};\n  }\n\n  const stubWindowFetch = _path.default.join(__dirname, 'polyfills', 'fetch', 'index.js');\n\n  const stubObjectAssign = _path.default.join(__dirname, 'polyfills', 'object-assign.js');\n\n  const shimAssign = _path.default.join(__dirname, 'polyfills', 'object.assign');\n\n  return Object.assign({}, {\n    unfetch$: stubWindowFetch,\n    'isomorphic-unfetch$': stubWindowFetch,\n    'whatwg-fetch$': _path.default.join(__dirname, 'polyfills', 'fetch', 'whatwg-fetch.js')\n  }, {\n    'object-assign$': stubObjectAssign,\n    // Stub Package: object.assign\n    'object.assign/auto': _path.default.join(shimAssign, 'auto.js'),\n    'object.assign/implementation': _path.default.join(shimAssign, 'implementation.js'),\n    'object.assign$': _path.default.join(shimAssign, 'index.js'),\n    'object.assign/polyfill': _path.default.join(shimAssign, 'polyfill.js'),\n    'object.assign/shim': _path.default.join(shimAssign, 'shim.js'),\n    // Replace: full URL polyfill with platform-based polyfill\n    url: require.resolve('native-url')\n  });\n}\n\nfunction attachReactRefresh(webpackConfig, targetLoader) {\n  var _webpackConfig$module;\n\n  let injections = 0;\n  const reactRefreshLoaderName = '@next/react-refresh-utils/loader';\n\n  const reactRefreshLoader = require.resolve(reactRefreshLoaderName);\n\n  (_webpackConfig$module = webpackConfig.module) == null ? void 0 : _webpackConfig$module.rules.forEach(rule => {\n    const curr = rule.use; // When the user has configured `defaultLoaders.babel` for a input file:\n\n    if (curr === targetLoader) {\n      ++injections;\n      rule.use = [reactRefreshLoader, curr];\n    } else if (Array.isArray(curr) && curr.some(r => r === targetLoader) && // Check if loader already exists:\n    !curr.some(r => r === reactRefreshLoader || r === reactRefreshLoaderName)) {\n      ++injections;\n      const idx = curr.findIndex(r => r === targetLoader); // Clone to not mutate user input\n\n      rule.use = [...curr]; // inject / input: [other, babel] output: [other, refresh, babel]:\n\n      rule.use.splice(idx, 0, reactRefreshLoader);\n    }\n  });\n\n  if (injections) {\n    Log.info(`automatically enabled Fast Refresh for ${injections} custom loader${injections > 1 ? 's' : ''}`);\n  }\n}\n\nasync function getBaseWebpackConfig(dir, {\n  buildId,\n  config,\n  dev = false,\n  isServer = false,\n  pagesDir,\n  tracer,\n  target = 'server',\n  reactProductionProfiling = false,\n  entrypoints,\n  rewrites\n}) {\n  var _jsConfig, _jsConfig$compilerOpt, _config$conformance, _config$conformance$D, _config$i18n, _jsConfig2, _jsConfig2$compilerOp, _webpackConfig$module2, _webpackConfig$module3;\n\n  let plugins = [];\n  let babelPresetPlugins = [];\n  const hasRewrites = rewrites.length > 0 || dev;\n\n  if (config.experimental.plugins) {\n    plugins = await (0, _collectPlugins.collectPlugins)(dir, config.env, config.plugins);\n    _nextPluginLoader.pluginLoaderOptions.plugins = plugins;\n\n    for (const plugin of plugins) {\n      if (plugin.middleware.includes('babel-preset-build')) {\n        babelPresetPlugins.push({\n          dir: plugin.directory,\n          config: plugin.config\n        });\n      }\n    }\n  }\n\n  const reactVersion = await (0, _getPackageVersion.getPackageVersion)({\n    cwd: dir,\n    name: 'react'\n  });\n  const hasReactRefresh = dev && !isServer;\n\n  const hasJsxRuntime = Boolean(reactVersion) && // 17.0.0-rc.0 had a breaking change not compatible with Next.js, but was\n  // fixed in rc.1.\n  _semver.default.gte(reactVersion, '17.0.0-rc.1');\n\n  const distDir = _path.default.join(dir, config.distDir);\n\n  const defaultLoaders = {\n    babel: {\n      loader: 'next-babel-loader',\n      options: {\n        isServer,\n        distDir,\n        pagesDir,\n        cwd: dir,\n        // Webpack 5 has a built-in loader cache\n        cache: !isWebpack5,\n        babelPresetPlugins,\n        development: dev,\n        hasReactRefresh,\n        hasJsxRuntime\n      }\n    },\n    // Backwards compat\n    hotSelfAccept: {\n      loader: 'noop-loader'\n    }\n  };\n  const babelIncludeRegexes = [/next[\\\\/]dist[\\\\/]next-server[\\\\/]lib/, /next[\\\\/]dist[\\\\/]client/, /next[\\\\/]dist[\\\\/]pages/, /[\\\\/](strip-ansi|ansi-regex)[\\\\/]/, ...(config.experimental.plugins ? _collectPlugins.VALID_MIDDLEWARE.map(name => new RegExp(`src(\\\\\\\\|/)${name}`)) : [])]; // Support for NODE_PATH\n\n  const nodePathList = (process.env.NODE_PATH || '').split(process.platform === 'win32' ? ';' : ':').filter(p => !!p);\n  const isServerless = target === 'serverless';\n  const isServerlessTrace = target === 'experimental-serverless-trace'; // Intentionally not using isTargetLikeServerless helper\n\n  const isLikeServerless = isServerless || isServerlessTrace;\n  const outputDir = isLikeServerless ? _constants2.SERVERLESS_DIRECTORY : _constants2.SERVER_DIRECTORY;\n\n  const outputPath = _path.default.join(distDir, isServer ? outputDir : '');\n\n  const totalPages = Object.keys(entrypoints).length;\n  const clientEntries = !isServer ? {\n    // Backwards compatibility\n    'main.js': [],\n    [_constants2.CLIENT_STATIC_FILES_RUNTIME_MAIN]: `./` + _path.default.relative(dir, _path.default.join(_constants.NEXT_PROJECT_ROOT_DIST_CLIENT, dev ? `next-dev.js` : 'next.js')).replace(/\\\\/g, '/'),\n    [_constants2.CLIENT_STATIC_FILES_RUNTIME_POLYFILLS]: _path.default.join(_constants.NEXT_PROJECT_ROOT_DIST_CLIENT, 'polyfills.js')\n  } : undefined;\n  let typeScriptPath;\n\n  try {\n    typeScriptPath = (0, _resolveRequest.resolveRequest)('typescript', `${dir}/`);\n  } catch (_) {}\n\n  const tsConfigPath = _path.default.join(dir, 'tsconfig.json');\n\n  const useTypeScript = Boolean(typeScriptPath && (await (0, _fileExists.fileExists)(tsConfigPath)));\n  let jsConfig; // jsconfig is a subset of tsconfig\n\n  if (useTypeScript) {\n    const ts = await Promise.resolve(`${typeScriptPath}`).then(s => _interopRequireWildcard(require(s)));\n    const tsConfig = await (0, _getTypeScriptConfiguration.getTypeScriptConfiguration)(ts, tsConfigPath);\n    jsConfig = {\n      compilerOptions: tsConfig.options\n    };\n  }\n\n  const jsConfigPath = _path.default.join(dir, 'jsconfig.json');\n\n  if (!useTypeScript && (await (0, _fileExists.fileExists)(jsConfigPath))) {\n    jsConfig = parseJsonFile(jsConfigPath);\n  }\n\n  let resolvedBaseUrl;\n\n  if ((_jsConfig = jsConfig) != null && (_jsConfig$compilerOpt = _jsConfig.compilerOptions) != null && _jsConfig$compilerOpt.baseUrl) {\n    resolvedBaseUrl = _path.default.resolve(dir, jsConfig.compilerOptions.baseUrl);\n  }\n\n  function getReactProfilingInProduction() {\n    if (reactProductionProfiling) {\n      return {\n        'react-dom$': 'react-dom/profiling',\n        'scheduler/tracing': 'scheduler/tracing-profiling'\n      };\n    }\n  }\n\n  const clientResolveRewrites = require.resolve('next/dist/next-server/lib/router/utils/resolve-rewrites');\n\n  const resolveConfig = {\n    // Disable .mjs for node_modules bundling\n    extensions: isServer ? ['.js', '.mjs', ...(useTypeScript ? ['.tsx', '.ts'] : []), '.jsx', '.json', '.wasm'] : ['.mjs', '.js', ...(useTypeScript ? ['.tsx', '.ts'] : []), '.jsx', '.json', '.wasm'],\n    modules: ['node_modules', ...nodePathList // Support for NODE_PATH environment variable\n    ],\n    alias: {\n      next: _constants.NEXT_PROJECT_ROOT,\n      ...(isWebpack5 && !isServer ? {\n        stream: require.resolve('stream-browserify'),\n        path: require.resolve('path-browserify'),\n        crypto: require.resolve('crypto-browserify'),\n        buffer: require.resolve('buffer'),\n        vm: require.resolve('vm-browserify')\n      } : undefined),\n      [_constants.PAGES_DIR_ALIAS]: pagesDir,\n      [_constants.DOT_NEXT_ALIAS]: distDir,\n      ...getOptimizedAliases(isServer),\n      ...getReactProfilingInProduction(),\n      [clientResolveRewrites]: hasRewrites ? clientResolveRewrites : require.resolve('next/dist/client/dev/noop.js')\n    },\n    mainFields: isServer ? ['main', 'module'] : ['browser', 'module', 'main'],\n    plugins: isWebpack5 ? // webpack 5+ has the PnP resolver built-in by default:\n    [] : [require('pnp-webpack-plugin')]\n  };\n  const terserOptions = {\n    parse: {\n      ecma: 8\n    },\n    compress: {\n      ecma: 5,\n      warnings: false,\n      // The following two options are known to break valid JavaScript code\n      comparisons: false,\n      inline: 2 // https://github.com/vercel/next.js/issues/7178#issuecomment-493048965\n\n    },\n    mangle: {\n      safari10: true\n    },\n    output: {\n      ecma: 5,\n      safari10: true,\n      comments: false,\n      // Fixes usage of Emoji and certain Regex\n      ascii_only: true\n    }\n  };\n\n  const isModuleCSS = module => {\n    return (// mini-css-extract-plugin\n      module.type === `css/mini-extract` || // extract-css-chunks-webpack-plugin (old)\n      module.type === `css/extract-chunks` || // extract-css-chunks-webpack-plugin (new)\n      module.type === `css/extract-css-chunks`\n    );\n  }; // Contains various versions of the Webpack SplitChunksPlugin used in different build types\n\n\n  const splitChunksConfigs = {\n    dev: {\n      cacheGroups: {\n        default: false,\n        vendors: false,\n        // In webpack 5 vendors was renamed to defaultVendors\n        defaultVendors: false\n      }\n    },\n    prodGranular: {\n      chunks: 'all',\n      cacheGroups: {\n        default: false,\n        vendors: false,\n        // In webpack 5 vendors was renamed to defaultVendors\n        defaultVendors: false,\n        framework: {\n          chunks: 'all',\n          name: 'framework',\n          // This regex ignores nested copies of framework libraries so they're\n          // bundled with their issuer.\n          // https://github.com/vercel/next.js/pull/9012\n          test: /(?<!node_modules.*)[\\\\/]node_modules[\\\\/](react|react-dom|scheduler|prop-types|use-subscription)[\\\\/]/,\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from\n          // becoming a part of the commons chunk)\n          enforce: true\n        },\n        lib: {\n          test(module) {\n            return module.size() > 160000 && /node_modules[/\\\\]/.test(module.identifier());\n          },\n\n          name(module) {\n            const hash = _crypto.default.createHash('sha1');\n\n            if (isModuleCSS(module)) {\n              module.updateHash(hash);\n            } else {\n              if (!module.libIdent) {\n                throw new Error(`Encountered unknown module type: ${module.type}. Please open an issue.`);\n              }\n\n              hash.update(module.libIdent({\n                context: dir\n              }));\n            }\n\n            return hash.digest('hex').substring(0, 8);\n          },\n\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true\n        },\n        commons: {\n          name: 'commons',\n          minChunks: totalPages,\n          priority: 20\n        },\n        shared: {\n          name(module, chunks) {\n            return _crypto.default.createHash('sha1').update(chunks.reduce((acc, chunk) => {\n              return acc + chunk.name;\n            }, '')).digest('hex') + (isModuleCSS(module) ? '_CSS' : '');\n          },\n\n          priority: 10,\n          minChunks: 2,\n          reuseExistingChunk: true\n        }\n      },\n      maxInitialRequests: 25,\n      minSize: 20000\n    }\n  }; // Select appropriate SplitChunksPlugin config for this build\n\n  let splitChunksConfig;\n\n  if (dev) {\n    splitChunksConfig = splitChunksConfigs.dev;\n  } else {\n    splitChunksConfig = splitChunksConfigs.prodGranular;\n  }\n\n  const crossOrigin = config.crossOrigin;\n  let customAppFile = await (0, _findPageFile.findPageFile)(pagesDir, '/_app', config.pageExtensions);\n\n  if (customAppFile) {\n    customAppFile = _path.default.resolve(_path.default.join(pagesDir, customAppFile));\n  }\n\n  const conformanceConfig = Object.assign({\n    ReactSyncScriptsConformanceCheck: {\n      enabled: true\n    },\n    MinificationConformanceCheck: {\n      enabled: true\n    },\n    DuplicatePolyfillsConformanceCheck: {\n      enabled: true,\n      BlockedAPIToBePolyfilled: Object.assign([], ['fetch'], ((_config$conformance = config.conformance) == null ? void 0 : (_config$conformance$D = _config$conformance.DuplicatePolyfillsConformanceCheck) == null ? void 0 : _config$conformance$D.BlockedAPIToBePolyfilled) || [])\n    },\n    GranularChunksConformanceCheck: {\n      enabled: true\n    }\n  }, config.conformance);\n\n  function handleExternals(context, request, callback) {\n    if (request === 'next') {\n      return callback(undefined, `commonjs ${request}`);\n    }\n\n    const notExternalModules = ['next/app', 'next/document', 'next/link', 'next/image', 'next/error', 'string-hash', 'next/constants'];\n\n    if (notExternalModules.indexOf(request) !== -1) {\n      return callback();\n    } // We need to externalize internal requests for files intended to\n    // not be bundled.\n\n\n    const isLocal = request.startsWith('.') || // Always check for unix-style path, as webpack sometimes\n    // normalizes as posix.\n    _path.default.posix.isAbsolute(request) || // When on Windows, we also want to check for Windows-specific\n    // absolute paths.\n    process.platform === 'win32' && _path.default.win32.isAbsolute(request);\n\n    const isLikelyNextExternal = isLocal && /[/\\\\]next-server[/\\\\]/.test(request); // Relative requires don't need custom resolution, because they\n    // are relative to requests we've already resolved here.\n    // Absolute requires (require('/foo')) are extremely uncommon, but\n    // also have no need for customization as they're already resolved.\n\n    if (isLocal && !isLikelyNextExternal) {\n      return callback();\n    } // Resolve the import with the webpack provided context, this\n    // ensures we're resolving the correct version when multiple\n    // exist.\n\n\n    let res;\n\n    try {\n      res = (0, _resolveRequest.resolveRequest)(request, `${context}/`);\n    } catch (err) {\n      // If the request cannot be resolved, we need to tell webpack to\n      // \"bundle\" it so that webpack shows an error (that it cannot be\n      // resolved).\n      return callback();\n    } // Same as above, if the request cannot be resolved we need to have\n    // webpack \"bundle\" it so it surfaces the not found error.\n\n\n    if (!res) {\n      return callback();\n    }\n\n    let isNextExternal = false;\n\n    if (isLocal) {\n      // we need to process next-server/lib/router/router so that\n      // the DefinePlugin can inject process.env values\n      isNextExternal = /next[/\\\\]dist[/\\\\]next-server[/\\\\](?!lib[/\\\\]router[/\\\\]router)/.test(res);\n\n      if (!isNextExternal) {\n        return callback();\n      }\n    } // `isNextExternal` special cases Next.js' internal requires that\n    // should not be bundled. We need to skip the base resolve routine\n    // to prevent it from being bundled (assumes Next.js version cannot\n    // mismatch).\n\n\n    if (!isNextExternal) {\n      // Bundled Node.js code is relocated without its node_modules tree.\n      // This means we need to make sure its request resolves to the same\n      // package that'll be available at runtime. If it's not identical,\n      // we need to bundle the code (even if it _should_ be external).\n      let baseRes;\n\n      try {\n        baseRes = (0, _resolveRequest.resolveRequest)(request, `${dir}/`);\n      } catch (err) {\n        baseRes = null;\n      } // Same as above: if the package, when required from the root,\n      // would be different from what the real resolution would use, we\n      // cannot externalize it.\n\n\n      if (!baseRes || baseRes !== res && // if res and baseRes are symlinks they could point to the the same file\n      (0, _fs.realpathSync)(baseRes) !== (0, _fs.realpathSync)(res)) {\n        return callback();\n      }\n    } // Default pages have to be transpiled\n\n\n    if (!res.match(/next[/\\\\]dist[/\\\\]next-server[/\\\\]/) && (res.match(/[/\\\\]next[/\\\\]dist[/\\\\]/) || // This is the @babel/plugin-transform-runtime \"helpers: true\" option\n    res.match(/node_modules[/\\\\]@babel[/\\\\]runtime[/\\\\]/))) {\n      return callback();\n    } // Webpack itself has to be compiled because it doesn't always use module relative paths\n\n\n    if (res.match(/node_modules[/\\\\]webpack/) || res.match(/node_modules[/\\\\]css-loader/)) {\n      return callback();\n    } // Anything else that is standard JavaScript within `node_modules`\n    // can be externalized.\n\n\n    if (isNextExternal || res.match(/node_modules[/\\\\].*\\.js$/)) {\n      const externalRequest = isNextExternal ? // Generate Next.js external import\n      _path.default.posix.join('next', 'dist', _path.default.relative( // Root of Next.js package:\n      _path.default.join(__dirname, '..'), res) // Windows path normalization\n      .replace(/\\\\/g, '/')) : request;\n      return callback(undefined, `commonjs ${externalRequest}`);\n    } // Default behavior: bundle the code!\n\n\n    callback();\n  }\n\n  const emacsLockfilePattern = '**/.#*';\n  let webpackConfig = {\n    externals: !isServer ? // make sure importing \"next\" is handled gracefully for client\n    // bundles in case a user imported types and it wasn't removed\n    // TODO: should we warn/error for this instead?\n    ['next'] : !isServerless ? [isWebpack5 ? ({\n      context,\n      request\n    }, callback) => handleExternals(context, request, callback) : (context, request, callback) => handleExternals(context, request, callback)] : [// When the 'serverless' target is used all node_modules will be compiled into the output bundles\n    // So that the 'serverless' bundles have 0 runtime dependencies\n    '@ampproject/toolbox-optimizer', // except this one\n    // Mark this as external if not enabled so it doesn't cause a\n    // webpack error from being missing\n    ...(config.experimental.optimizeCss ? [] : ['critters'])],\n    optimization: { // Webpack 5 uses a new property for the same functionality\n      ...(isWebpack5 ? {\n        emitOnErrors: !dev\n      } : {\n        noEmitOnErrors: dev\n      }),\n      checkWasmTypes: false,\n      nodeEnv: false,\n      splitChunks: isServer ? false : splitChunksConfig,\n      runtimeChunk: isServer ? isWebpack5 && !isLikeServerless ? {\n        name: 'webpack-runtime'\n      } : undefined : {\n        name: _constants2.CLIENT_STATIC_FILES_RUNTIME_WEBPACK\n      },\n      minimize: !(dev || isServer),\n      minimizer: [// Minify JavaScript\n      new _index.default({\n        cacheDir: _path.default.join(distDir, 'cache', 'next-minifier'),\n        parallel: config.experimental.cpus,\n        terserOptions\n      }), // Minify CSS\n      new _cssMinimizerPlugin.CssMinimizerPlugin({\n        postcssOptions: {\n          map: {\n            // `inline: false` generates the source map in a separate file.\n            // Otherwise, the CSS file is needlessly large.\n            inline: false,\n            // `annotation: false` skips appending the `sourceMappingURL`\n            // to the end of the CSS file. Webpack already handles this.\n            annotation: false\n          }\n        }\n      })]\n    },\n    context: dir,\n    node: {\n      setImmediate: false\n    },\n    // Kept as function to be backwards compatible\n    entry: async () => {\n      return { ...(clientEntries ? clientEntries : {}),\n        ...entrypoints,\n        ...(isServer ? {\n          'init-server.js': 'next-plugin-loader?middleware=on-init-server!',\n          'on-error-server.js': 'next-plugin-loader?middleware=on-error-server!'\n        } : {})\n      };\n    },\n    watchOptions: {\n      ignored: ['**/.git/**', '**/node_modules/**', '**/.next/**', // can be removed after https://github.com/paulmillr/chokidar/issues/955 is released\n      emacsLockfilePattern]\n    },\n    output: { ...(isWebpack5 ? {\n        environment: {\n          arrowFunction: false,\n          bigIntLiteral: false,\n          const: false,\n          destructuring: false,\n          dynamicImport: false,\n          forOf: false,\n          module: false\n        }\n      } : {}),\n      path: outputPath,\n      // On the server we don't use the chunkhash\n      filename: isServer ? '[name].js' : `static/chunks/[name]${dev ? '' : '-[chunkhash]'}.js`,\n      library: isServer ? undefined : '_N_E',\n      libraryTarget: isServer ? 'commonjs2' : 'assign',\n      hotUpdateChunkFilename: isWebpack5 ? 'static/webpack/[id].[fullhash].hot-update.js' : 'static/webpack/[id].[hash].hot-update.js',\n      hotUpdateMainFilename: isWebpack5 ? 'static/webpack/[fullhash].hot-update.json' : 'static/webpack/[hash].hot-update.json',\n      // This saves chunks with the name given via `import()`\n      chunkFilename: isServer ? `${dev ? '[name]' : '[name].[contenthash]'}.js` : `static/chunks/${dev ? '[name]' : '[name].[contenthash]'}.js`,\n      strictModuleExceptionHandling: true,\n      crossOriginLoading: crossOrigin,\n      futureEmitAssets: !dev,\n      webassemblyModuleFilename: 'static/wasm/[modulehash].wasm'\n    },\n    performance: false,\n    resolve: resolveConfig,\n    resolveLoader: {\n      // The loaders Next.js provides\n      alias: ['emit-file-loader', 'error-loader', 'next-babel-loader', 'next-client-pages-loader', 'next-serverless-loader', 'noop-loader', 'next-plugin-loader'].reduce((alias, loader) => {\n        // using multiple aliases to replace `resolveLoader.modules`\n        alias[loader] = _path.default.join(__dirname, 'webpack', 'loaders', loader);\n        return alias;\n      }, {}),\n      modules: ['node_modules', ...nodePathList // Support for NODE_PATH environment variable\n      ],\n      plugins: isWebpack5 ? [] : [require('pnp-webpack-plugin')]\n    },\n    module: {\n      rules: [...(isWebpack5 ? [// TODO: FIXME: do NOT webpack 5 support with this\n      // x-ref: https://github.com/webpack/webpack/issues/11467\n      {\n        test: /\\.m?js/,\n        resolve: {\n          fullySpecified: false\n        }\n      }] : []), {\n        test: /\\.(tsx|ts|js|mjs|jsx)$/,\n        include: [dir, ...babelIncludeRegexes],\n        exclude: excludePath => {\n          if (babelIncludeRegexes.some(r => r.test(excludePath))) {\n            return false;\n          }\n\n          return /node_modules/.test(excludePath);\n        },\n        use: config.experimental.babelMultiThread ? [// Move Babel transpilation into a thread pool (2 workers, unlimited batch size).\n        // Applying a cache to the off-thread work avoids paying transfer costs for unchanged modules.\n        {\n          loader: 'next/dist/compiled/cache-loader',\n          options: {\n            cacheContext: dir,\n            cacheDirectory: _path.default.join(dir, '.next', 'cache', 'webpack'),\n            cacheIdentifier: `webpack${isServer ? '-server' : ''}`\n          }\n        }, {\n          loader: require.resolve('next/dist/compiled/thread-loader'),\n          options: {\n            workers: 2,\n            workerParallelJobs: Infinity\n          }\n        }, hasReactRefresh ? require.resolve('@next/react-refresh-utils/loader') : '', defaultLoaders.babel].filter(Boolean) : hasReactRefresh ? [require.resolve('@next/react-refresh-utils/loader'), defaultLoaders.babel] : defaultLoaders.babel\n      }].filter(Boolean)\n    },\n    plugins: [hasReactRefresh && new _ReactRefreshWebpackPlugin.default(), // Makes sure `Buffer` is polyfilled in client-side bundles (same behavior as webpack 4)\n    isWebpack5 && !isServer && new _webpack.default.ProvidePlugin({\n      Buffer: ['buffer', 'Buffer']\n    }), // Makes sure `process` is polyfilled in client-side bundles (same behavior as webpack 4)\n    isWebpack5 && !isServer && new _webpack.default.ProvidePlugin({\n      process: ['process']\n    }), // This plugin makes sure `output.filename` is used for entry chunks\n    !isWebpack5 && new _chunkNamesPlugin.default(), new _webpack.default.DefinePlugin({ ...Object.keys(process.env).reduce((prev, key) => {\n        if (key.startsWith('NEXT_PUBLIC_')) {\n          prev[`process.env.${key}`] = JSON.stringify(process.env[key]);\n        }\n\n        return prev;\n      }, {}),\n      ...Object.keys(config.env).reduce((acc, key) => {\n        if (/^(?:NODE_.+)|^(?:__.+)$/i.test(key)) {\n          throw new Error(`The key \"${key}\" under \"env\" in next.config.js is not allowed. https://err.sh/vercel/next.js/env-key-not-allowed`);\n        }\n\n        return { ...acc,\n          [`process.env.${key}`]: JSON.stringify(config.env[key])\n        };\n      }, {}),\n      // TODO: enforce `NODE_ENV` on `process.env`, and add a test:\n      'process.env.NODE_ENV': JSON.stringify(dev ? 'development' : 'production'),\n      'process.env.__NEXT_CROSS_ORIGIN': JSON.stringify(crossOrigin),\n      'process.browser': JSON.stringify(!isServer),\n      'process.env.__NEXT_TEST_MODE': JSON.stringify(process.env.__NEXT_TEST_MODE),\n      // This is used in client/dev-error-overlay/hot-dev-client.js to replace the dist directory\n      ...(dev && !isServer ? {\n        'process.env.__NEXT_DIST_DIR': JSON.stringify(distDir)\n      } : {}),\n      'process.env.__NEXT_TRAILING_SLASH': JSON.stringify(config.trailingSlash),\n      'process.env.__NEXT_BUILD_INDICATOR': JSON.stringify(config.devIndicators.buildActivity),\n      'process.env.__NEXT_PLUGINS': JSON.stringify(config.experimental.plugins),\n      'process.env.__NEXT_STRICT_MODE': JSON.stringify(config.reactStrictMode),\n      'process.env.__NEXT_REACT_MODE': JSON.stringify(config.experimental.reactMode),\n      'process.env.__NEXT_OPTIMIZE_FONTS': JSON.stringify(config.experimental.optimizeFonts && !dev),\n      'process.env.__NEXT_OPTIMIZE_IMAGES': JSON.stringify(config.experimental.optimizeImages),\n      'process.env.__NEXT_OPTIMIZE_CSS': JSON.stringify(!!config.experimental.optimizeCss && !dev),\n      'process.env.__NEXT_SCROLL_RESTORATION': JSON.stringify(config.experimental.scrollRestoration),\n      'process.env.__NEXT_IMAGE_OPTS': JSON.stringify({\n        deviceSizes: config.images.deviceSizes,\n        imageSizes: config.images.imageSizes,\n        path: config.images.path,\n        loader: config.images.loader,\n        ...(dev ? {\n          // pass domains in development to allow validating on the client\n          domains: config.images.domains\n        } : {})\n      }),\n      'process.env.__NEXT_ROUTER_BASEPATH': JSON.stringify(config.basePath),\n      'process.env.__NEXT_HAS_REWRITES': JSON.stringify(hasRewrites),\n      'process.env.__NEXT_I18N_SUPPORT': JSON.stringify(!!config.i18n),\n      'process.env.__NEXT_I18N_DOMAINS': JSON.stringify((_config$i18n = config.i18n) == null ? void 0 : _config$i18n.domains),\n      'process.env.__NEXT_ANALYTICS_ID': JSON.stringify(config.analyticsId),\n      ...(isServer ? {\n        // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)\n        // This is typically found in unmaintained modules from the\n        // pre-webpack era (common in server-side code)\n        'global.GENTLY': JSON.stringify(false)\n      } : undefined),\n      // stub process.env with proxy to warn a missing value is\n      // being accessed in development mode\n      ...(config.experimental.pageEnv && dev ? {\n        'process.env': `\n            new Proxy(${isServer ? 'process.env' : '{}'}, {\n              get(target, prop) {\n                if (typeof target[prop] === 'undefined') {\n                  console.warn(\\`An environment variable (\\${prop}) that was not provided in the environment was accessed.\\nSee more info here: https://err.sh/next.js/missing-env-value\\`)\n                }\n                return target[prop]\n              }\n            })\n          `\n      } : {})\n    }), !isServer && new _reactLoadablePlugin.ReactLoadablePlugin({\n      filename: _constants2.REACT_LOADABLE_MANIFEST\n    }), !isServer && new _nextDropClientPagePlugin.DropClientPage(), // Moment.js is an extremely popular library that bundles large locale files\n    // by default due to how Webpack interprets its code. This is a practical\n    // solution that requires the user to opt into importing specific locales.\n    // https://github.com/jmblog/how-to-optimize-momentjs-with-webpack\n    config.future.excludeDefaultMomentLocales && new _webpack.default.IgnorePlugin({\n      resourceRegExp: /^\\.\\/locale$/,\n      contextRegExp: /moment$/\n    }), ...(dev ? (() => {\n      // Even though require.cache is server only we have to clear assets from both compilations\n      // This is because the client compilation generates the build manifest that's used on the server side\n      const {\n        NextJsRequireCacheHotReloader\n      } = require('./webpack/plugins/nextjs-require-cache-hot-reloader');\n\n      const devPlugins = [new NextJsRequireCacheHotReloader()];\n\n      if (!isServer) {\n        devPlugins.push(new _webpack.default.HotModuleReplacementPlugin());\n      }\n\n      return devPlugins;\n    })() : []), // Webpack 5 no longer requires this plugin in production:\n    !isWebpack5 && !dev && new _webpack.default.HashedModuleIdsPlugin(), !dev && new _webpack.default.IgnorePlugin({\n      resourceRegExp: /react-is/,\n      contextRegExp: /(next-server|next)[\\\\/]dist[\\\\/]/\n    }), isServerless && isServer && new _serverlessPlugin.ServerlessPlugin(), isServer && new _pagesManifestPlugin.default(isLikeServerless), !isWebpack5 && target === 'server' && isServer && new _nextjsSsrModuleCache.default({\n      outputPath\n    }), isServer && new _nextjsSsrImport.default(), !isServer && new _buildManifestPlugin.default({\n      buildId,\n      rewrites\n    }), tracer && new _profilingPlugin.ProfilingPlugin({\n      tracer\n    }), config.experimental.optimizeFonts && !dev && isServer && function () {\n      const {\n        FontStylesheetGatheringPlugin\n      } = require('./webpack/plugins/font-stylesheet-gathering-plugin');\n\n      return new FontStylesheetGatheringPlugin();\n    }(), config.experimental.conformance && !isWebpack5 && !dev && new _webpackConformancePlugin.default({\n      tests: [!isServer && conformanceConfig.MinificationConformanceCheck.enabled && new _webpackConformancePlugin.MinificationConformanceCheck(), conformanceConfig.ReactSyncScriptsConformanceCheck.enabled && new _webpackConformancePlugin.ReactSyncScriptsConformanceCheck({\n        AllowedSources: conformanceConfig.ReactSyncScriptsConformanceCheck.allowedSources || []\n      }), !isServer && conformanceConfig.DuplicatePolyfillsConformanceCheck.enabled && new _webpackConformancePlugin.DuplicatePolyfillsConformanceCheck({\n        BlockedAPIToBePolyfilled: conformanceConfig.DuplicatePolyfillsConformanceCheck.BlockedAPIToBePolyfilled\n      }), !isServer && conformanceConfig.GranularChunksConformanceCheck.enabled && new _webpackConformancePlugin.GranularChunksConformanceCheck(splitChunksConfigs.prodGranular)].filter(Boolean)\n    }), new _wellknownErrorsPlugin.WellKnownErrorsPlugin()].filter(Boolean)\n  }; // Support tsconfig and jsconfig baseUrl\n\n  if (resolvedBaseUrl) {\n    var _webpackConfig$resolv, _webpackConfig$resolv2;\n\n    (_webpackConfig$resolv = webpackConfig.resolve) == null ? void 0 : (_webpackConfig$resolv2 = _webpackConfig$resolv.modules) == null ? void 0 : _webpackConfig$resolv2.push(resolvedBaseUrl);\n  }\n\n  if ((_jsConfig2 = jsConfig) != null && (_jsConfig2$compilerOp = _jsConfig2.compilerOptions) != null && _jsConfig2$compilerOp.paths && resolvedBaseUrl) {\n    var _webpackConfig$resolv3, _webpackConfig$resolv4;\n\n    (_webpackConfig$resolv3 = webpackConfig.resolve) == null ? void 0 : (_webpackConfig$resolv4 = _webpackConfig$resolv3.plugins) == null ? void 0 : _webpackConfig$resolv4.unshift(new _jsconfigPathsPlugin.JsConfigPathsPlugin(jsConfig.compilerOptions.paths, resolvedBaseUrl));\n  }\n\n  if (isWebpack5) {\n    var _webpackConfig$output; // futureEmitAssets is on by default in webpack 5\n\n\n    (_webpackConfig$output = webpackConfig.output) == null ? true : delete _webpackConfig$output.futureEmitAssets; // webpack 5 no longer polyfills Node.js modules:\n\n    if (webpackConfig.node) delete webpackConfig.node.setImmediate;\n\n    if (dev) {\n      if (!webpackConfig.optimization) {\n        webpackConfig.optimization = {};\n      }\n\n      webpackConfig.optimization.providedExports = false;\n      webpackConfig.optimization.usedExports = false;\n    }\n\n    const nextPublicVariables = Object.keys(process.env).reduce((acc, key) => {\n      if (key.startsWith('NEXT_PUBLIC_')) {\n        return [...acc, `${key}=${process.env[key]}`];\n      }\n\n      return acc;\n    }, []).join('|');\n    const nextEnvVariables = Object.keys(config.env).reduce((prev, key) => {\n      return `${prev}|${key}=${config.env[key]}`;\n    }, '');\n    const configVars = JSON.stringify({\n      crossOrigin: config.crossOrigin,\n      pageExtensions: config.pageExtensions,\n      trailingSlash: config.trailingSlash,\n      buildActivity: config.devIndicators.buildActivity,\n      plugins: config.experimental.plugins,\n      reactStrictMode: config.reactStrictMode,\n      reactMode: config.experimental.reactMode,\n      optimizeFonts: config.experimental.optimizeFonts,\n      optimizeImages: config.experimental.optimizeImages,\n      scrollRestoration: config.experimental.scrollRestoration,\n      basePath: config.basePath,\n      pageEnv: config.experimental.pageEnv,\n      excludeDefaultMomentLocales: config.future.excludeDefaultMomentLocales,\n      assetPrefix: config.assetPrefix,\n      target,\n      reactProductionProfiling\n    });\n    const cache = {\n      type: 'filesystem',\n      // Includes:\n      //  - Next.js version\n      //  - NEXT_PUBLIC_ variable values (they affect caching) TODO: make this module usage only\n      //  - next.config.js `env` key\n      //  - next.config.js keys that affect compilation\n      version: `${\"10.0.5\"}|${nextPublicVariables}|${nextEnvVariables}|${configVars}`,\n      cacheDirectory: _path.default.join(dir, '.next', 'cache', 'webpack')\n    }; // Adds `next.config.js` as a buildDependency when custom webpack config is provided\n\n    if (config.webpack && config.configFile) {\n      cache.buildDependencies = {\n        config: [config.configFile]\n      };\n    }\n\n    webpackConfig.cache = cache; // @ts-ignore TODO: remove ignore when webpack 5 is stable\n\n    webpackConfig.optimization.realContentHash = false;\n  }\n\n  webpackConfig = await (0, _config.build)(webpackConfig, {\n    rootDirectory: dir,\n    customAppFile,\n    isDevelopment: dev,\n    isServer,\n    assetPrefix: config.assetPrefix || '',\n    sassOptions: config.sassOptions,\n    productionBrowserSourceMaps: config.productionBrowserSourceMaps\n  });\n  let originalDevtool = webpackConfig.devtool;\n\n  if (typeof config.webpack === 'function') {\n    webpackConfig = config.webpack(webpackConfig, {\n      dir,\n      dev,\n      isServer,\n      buildId,\n      config,\n      defaultLoaders,\n      totalPages,\n      webpack: _webpack.default\n    });\n\n    if (!webpackConfig) {\n      throw new Error('Webpack config is undefined. You may have forgot to return properly from within the \"webpack\" method of your next.config.js.\\n' + 'See more info here https://err.sh/next.js/undefined-webpack-config');\n    }\n\n    if (dev && originalDevtool !== webpackConfig.devtool) {\n      webpackConfig.devtool = originalDevtool;\n      devtoolRevertWarning(originalDevtool);\n    }\n\n    if (typeof webpackConfig.then === 'function') {\n      console.warn('> Promise returned in next config. https://err.sh/vercel/next.js/promise-in-next-config');\n    }\n  } // Backwards compat with webpack-dev-middleware options object\n\n\n  if (typeof config.webpackDevMiddleware === 'function') {\n    const options = config.webpackDevMiddleware({\n      watchOptions: webpackConfig.watchOptions\n    });\n\n    if (options.watchOptions) {\n      webpackConfig.watchOptions = options.watchOptions;\n    }\n  }\n\n  function canMatchCss(rule) {\n    if (!rule) {\n      return false;\n    }\n\n    const fileNames = ['/tmp/test.css', '/tmp/test.scss', '/tmp/test.sass', '/tmp/test.less', '/tmp/test.styl'];\n\n    if (rule instanceof RegExp && fileNames.some(input => rule.test(input))) {\n      return true;\n    }\n\n    if (typeof rule === 'function') {\n      if (fileNames.some(input => {\n        try {\n          if (rule(input)) {\n            return true;\n          }\n        } catch (_) {}\n\n        return false;\n      })) {\n        return true;\n      }\n    }\n\n    if (Array.isArray(rule) && rule.some(canMatchCss)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  const hasUserCssConfig = (_webpackConfig$module2 = (_webpackConfig$module3 = webpackConfig.module) == null ? void 0 : _webpackConfig$module3.rules.some(rule => canMatchCss(rule.test) || canMatchCss(rule.include))) != null ? _webpackConfig$module2 : false;\n\n  if (hasUserCssConfig) {\n    var _webpackConfig$module4, _webpackConfig$plugin, _webpackConfig$optimi, _webpackConfig$optimi2; // only show warning for one build\n\n\n    if (isServer) {\n      console.warn(_chalk.default.yellow.bold('Warning: ') + _chalk.default.bold('Built-in CSS support is being disabled due to custom CSS configuration being detected.\\n') + 'See here for more info: https://err.sh/next.js/built-in-css-disabled\\n');\n    }\n\n    if ((_webpackConfig$module4 = webpackConfig.module) != null && _webpackConfig$module4.rules.length) {\n      // Remove default CSS Loader\n      webpackConfig.module.rules = webpackConfig.module.rules.filter(r => {\n        var _r$oneOf, _r$oneOf$;\n\n        return !(typeof ((_r$oneOf = r.oneOf) == null ? void 0 : (_r$oneOf$ = _r$oneOf[0]) == null ? void 0 : _r$oneOf$.options) === 'object' && r.oneOf[0].options.__next_css_remove === true);\n      });\n    }\n\n    if ((_webpackConfig$plugin = webpackConfig.plugins) != null && _webpackConfig$plugin.length) {\n      // Disable CSS Extraction Plugin\n      webpackConfig.plugins = webpackConfig.plugins.filter(p => p.__next_css_remove !== true);\n    }\n\n    if ((_webpackConfig$optimi = webpackConfig.optimization) != null && (_webpackConfig$optimi2 = _webpackConfig$optimi.minimizer) != null && _webpackConfig$optimi2.length) {\n      // Disable CSS Minifier\n      webpackConfig.optimization.minimizer = webpackConfig.optimization.minimizer.filter(e => e.__next_css_remove !== true);\n    }\n  } else {\n    await (0, _overrideCssConfiguration.__overrideCssConfiguration)(dir, !dev, webpackConfig);\n  } // Inject missing React Refresh loaders so that development mode is fast:\n\n\n  if (hasReactRefresh) {\n    attachReactRefresh(webpackConfig, defaultLoaders.babel);\n  } // check if using @zeit/next-typescript and show warning\n\n\n  if (isServer && webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    let foundTsRule = false;\n    webpackConfig.module.rules = webpackConfig.module.rules.filter(rule => {\n      if (!(rule.test instanceof RegExp)) return true;\n\n      if ('noop.ts'.match(rule.test) && !'noop.js'.match(rule.test)) {\n        // remove if it matches @zeit/next-typescript\n        foundTsRule = rule.use === defaultLoaders.babel;\n        return !foundTsRule;\n      }\n\n      return true;\n    });\n\n    if (foundTsRule) {\n      console.warn('\\n@zeit/next-typescript is no longer needed since Next.js has built-in support for TypeScript now. Please remove it from your next.config.js and your .babelrc\\n');\n    }\n  } // Patch `@zeit/next-sass`, `@zeit/next-less`, `@zeit/next-stylus` for compatibility\n\n\n  if (webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    ;\n    [].forEach.call(webpackConfig.module.rules, function (rule) {\n      if (!(rule.test instanceof RegExp && Array.isArray(rule.use))) {\n        return;\n      }\n\n      const isSass = rule.test.source === '\\\\.scss$' || rule.test.source === '\\\\.sass$';\n      const isLess = rule.test.source === '\\\\.less$';\n      const isCss = rule.test.source === '\\\\.css$';\n      const isStylus = rule.test.source === '\\\\.styl$'; // Check if the rule we're iterating over applies to Sass, Less, or CSS\n\n      if (!(isSass || isLess || isCss || isStylus)) {\n        return;\n      }\n\n      ;\n      [].forEach.call(rule.use, function (use) {\n        if (!(use && typeof use === 'object' && ( // Identify use statements only pertaining to `css-loader`\n        use.loader === 'css-loader' || use.loader === 'css-loader/locals') && use.options && typeof use.options === 'object' && ( // The `minimize` property is a good heuristic that we need to\n        // perform this hack. The `minimize` property was only valid on\n        // old `css-loader` versions. Custom setups (that aren't next-sass,\n        // next-less or next-stylus) likely have the newer version.\n        // We still handle this gracefully below.\n        Object.prototype.hasOwnProperty.call(use.options, 'minimize') || Object.prototype.hasOwnProperty.call(use.options, 'exportOnlyLocals')))) {\n          return;\n        } // Try to monkey patch within a try-catch. We shouldn't fail the build\n        // if we cannot pull this off.\n        // The user may not even be using the `next-sass` or `next-less` or\n        // `next-stylus` plugins.\n        // If it does work, great!\n\n\n        try {\n          // Resolve the version of `@zeit/next-css` as depended on by the Sass,\n          // Less or Stylus plugin.\n          const correctNextCss = (0, _resolveRequest.resolveRequest)('@zeit/next-css', isCss ? // Resolve `@zeit/next-css` from the base directory\n          `${dir}/` : // Else, resolve it from the specific plugins\n          require.resolve(isSass ? '@zeit/next-sass' : isLess ? '@zeit/next-less' : isStylus ? '@zeit/next-stylus' : 'next')); // If we found `@zeit/next-css` ...\n\n          if (correctNextCss) {\n            // ... resolve the version of `css-loader` shipped with that\n            // package instead of whichever was hoisted highest in your\n            // `node_modules` tree.\n            const correctCssLoader = (0, _resolveRequest.resolveRequest)(use.loader, correctNextCss);\n\n            if (correctCssLoader) {\n              // We saved the user from a failed build!\n              use.loader = correctCssLoader;\n            }\n          }\n        } catch (_) {// The error is not required to be handled.\n        }\n      });\n    });\n  } // Backwards compat for `main.js` entry key\n\n\n  const originalEntry = webpackConfig.entry;\n\n  if (typeof originalEntry !== 'undefined') {\n    webpackConfig.entry = async () => {\n      const entry = typeof originalEntry === 'function' ? await originalEntry() : originalEntry; // Server compilation doesn't have main.js\n\n      if (clientEntries && entry['main.js'] && entry['main.js'].length > 0) {\n        const originalFile = clientEntries[_constants2.CLIENT_STATIC_FILES_RUNTIME_MAIN];\n        entry[_constants2.CLIENT_STATIC_FILES_RUNTIME_MAIN] = [...entry['main.js'], originalFile];\n      }\n\n      delete entry['main.js'];\n      return entry;\n    };\n  }\n\n  if (!dev) {\n    // entry is always a function\n    webpackConfig.entry = await webpackConfig.entry();\n  }\n\n  return webpackConfig;\n}","map":{"version":3,"sources":["../../build/webpack-config.ts"],"names":["isWebpack5","parseInt","webpack","semver","Log","process","devtoolRevertWarning","devtool","console","chalk","JSON5","require","contents","codeFrame","String","start","line","err","column","message","highlightCode","filePath","stubWindowFetch","path","stubObjectAssign","shimAssign","unfetch$","url","injections","reactRefreshLoaderName","reactRefreshLoader","rule","curr","Array","r","idx","dev","isServer","target","reactProductionProfiling","plugins","babelPresetPlugins","hasRewrites","rewrites","config","pluginLoaderOptions","plugin","dir","reactVersion","cwd","name","hasReactRefresh","hasJsxRuntime","Boolean","distDir","defaultLoaders","babel","loader","options","cache","development","hotSelfAccept","babelIncludeRegexes","VALID_MIDDLEWARE","nodePathList","p","isServerless","isServerlessTrace","isLikeServerless","outputDir","SERVERLESS_DIRECTORY","SERVER_DIRECTORY","outputPath","totalPages","Object","clientEntries","CLIENT_STATIC_FILES_RUNTIME_MAIN","NEXT_PROJECT_ROOT_DIST_CLIENT","CLIENT_STATIC_FILES_RUNTIME_POLYFILLS","typeScriptPath","tsConfigPath","useTypeScript","ts","tsConfig","jsConfig","compilerOptions","jsConfigPath","parseJsonFile","resolvedBaseUrl","clientResolveRewrites","resolveConfig","extensions","modules","alias","next","NEXT_PROJECT_ROOT","stream","crypto","buffer","vm","PAGES_DIR_ALIAS","DOT_NEXT_ALIAS","getOptimizedAliases","getReactProfilingInProduction","mainFields","terserOptions","parse","ecma","compress","warnings","comparisons","inline","mangle","safari10","output","comments","ascii_only","isModuleCSS","module","splitChunksConfigs","cacheGroups","default","vendors","defaultVendors","prodGranular","chunks","framework","test","priority","enforce","lib","hash","type","context","minChunks","reuseExistingChunk","commons","shared","acc","chunk","maxInitialRequests","minSize","splitChunksConfig","crossOrigin","customAppFile","conformanceConfig","ReactSyncScriptsConformanceCheck","enabled","MinificationConformanceCheck","DuplicatePolyfillsConformanceCheck","BlockedAPIToBePolyfilled","GranularChunksConformanceCheck","request","callback","notExternalModules","isLocal","isLikelyNextExternal","res","isNextExternal","baseRes","externalRequest","emacsLockfilePattern","webpackConfig","externals","handleExternals","optimization","emitOnErrors","noEmitOnErrors","checkWasmTypes","nodeEnv","splitChunks","runtimeChunk","CLIENT_STATIC_FILES_RUNTIME_WEBPACK","minimize","minimizer","TerserPlugin","cacheDir","parallel","CssMinimizerPlugin","postcssOptions","map","annotation","node","setImmediate","entry","watchOptions","ignored","environment","arrowFunction","bigIntLiteral","const","destructuring","dynamicImport","forOf","filename","library","libraryTarget","hotUpdateChunkFilename","hotUpdateMainFilename","chunkFilename","strictModuleExceptionHandling","crossOriginLoading","futureEmitAssets","webassemblyModuleFilename","performance","resolve","resolveLoader","rules","fullySpecified","include","exclude","excludePath","use","cacheContext","cacheDirectory","cacheIdentifier","workers","workerParallelJobs","ReactRefreshWebpackPlugin","Buffer","ChunkNamesPlugin","key","prev","JSON","deviceSizes","imageSizes","domains","ReactLoadablePlugin","REACT_LOADABLE_MANIFEST","DropClientPage","resourceRegExp","contextRegExp","devPlugins","ServerlessPlugin","PagesManifestPlugin","NextJsSSRModuleCachePlugin","NextJsSsrImportPlugin","BuildManifestPlugin","tracer","ProfilingPlugin","WebpackConformancePlugin","tests","AllowedSources","WellKnownErrorsPlugin","JsConfigPathsPlugin","nextPublicVariables","nextEnvVariables","configVars","pageExtensions","trailingSlash","buildActivity","reactStrictMode","reactMode","optimizeFonts","optimizeImages","scrollRestoration","basePath","pageEnv","excludeDefaultMomentLocales","assetPrefix","version","__NEXT_VERSION","rootDirectory","isDevelopment","sassOptions","productionBrowserSourceMaps","originalDevtool","fileNames","input","hasUserCssConfig","canMatchCss","e","attachReactRefresh","foundTsRule","isSass","isLess","isCss","isStylus","correctNextCss","correctCssLoader","originalEntry","originalFile"],"mappings":"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","sourcesContent":["import { codeFrameColumns } from 'next/dist/compiled/babel/code-frame'\nimport ReactRefreshWebpackPlugin from '@next/react-refresh-utils/ReactRefreshWebpackPlugin'\nimport crypto from 'crypto'\nimport { readFileSync, realpathSync } from 'fs'\nimport chalk from 'chalk'\nimport semver from 'next/dist/compiled/semver'\n// @ts-ignore No typings yet\nimport TerserPlugin from './webpack/plugins/terser-webpack-plugin/src/index.js'\nimport path from 'path'\nimport webpack from 'webpack'\nimport { Configuration } from 'webpack'\nimport {\n  DOT_NEXT_ALIAS,\n  NEXT_PROJECT_ROOT,\n  NEXT_PROJECT_ROOT_DIST_CLIENT,\n  PAGES_DIR_ALIAS,\n} from '../lib/constants'\nimport { fileExists } from '../lib/file-exists'\nimport { getPackageVersion } from '../lib/get-package-version'\nimport { Rewrite } from '../lib/load-custom-routes'\nimport { resolveRequest } from '../lib/resolve-request'\nimport { getTypeScriptConfiguration } from '../lib/typescript/getTypeScriptConfiguration'\nimport {\n  CLIENT_STATIC_FILES_RUNTIME_MAIN,\n  CLIENT_STATIC_FILES_RUNTIME_POLYFILLS,\n  CLIENT_STATIC_FILES_RUNTIME_WEBPACK,\n  REACT_LOADABLE_MANIFEST,\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n} from '../next-server/lib/constants'\nimport { execOnce } from '../next-server/lib/utils'\nimport { findPageFile } from '../server/lib/find-page-file'\nimport { WebpackEntrypoints } from './entries'\nimport * as Log from './output/log'\nimport {\n  collectPlugins,\n  PluginMetaData,\n  VALID_MIDDLEWARE,\n} from './plugins/collect-plugins'\nimport { build as buildConfiguration } from './webpack/config'\nimport { __overrideCssConfiguration } from './webpack/config/blocks/css/overrideCssConfiguration'\nimport { pluginLoaderOptions } from './webpack/loaders/next-plugin-loader'\nimport BuildManifestPlugin from './webpack/plugins/build-manifest-plugin'\nimport ChunkNamesPlugin from './webpack/plugins/chunk-names-plugin'\nimport { CssMinimizerPlugin } from './webpack/plugins/css-minimizer-plugin'\nimport { JsConfigPathsPlugin } from './webpack/plugins/jsconfig-paths-plugin'\nimport { DropClientPage } from './webpack/plugins/next-drop-client-page-plugin'\nimport NextJsSsrImportPlugin from './webpack/plugins/nextjs-ssr-import'\nimport NextJsSSRModuleCachePlugin from './webpack/plugins/nextjs-ssr-module-cache'\nimport PagesManifestPlugin from './webpack/plugins/pages-manifest-plugin'\nimport { ProfilingPlugin } from './webpack/plugins/profiling-plugin'\nimport { ReactLoadablePlugin } from './webpack/plugins/react-loadable-plugin'\nimport { ServerlessPlugin } from './webpack/plugins/serverless-plugin'\nimport WebpackConformancePlugin, {\n  DuplicatePolyfillsConformanceCheck,\n  GranularChunksConformanceCheck,\n  MinificationConformanceCheck,\n  ReactSyncScriptsConformanceCheck,\n} from './webpack/plugins/webpack-conformance-plugin'\nimport { WellKnownErrorsPlugin } from './webpack/plugins/wellknown-errors-plugin'\nimport { NextConfig } from '../next-server/server/config'\n\ntype ExcludesFalse = <T>(x: T | false) => x is T\n\nconst isWebpack5 = parseInt(webpack.version!) === 5\n\nif (isWebpack5 && semver.lt(webpack.version!, '5.11.1')) {\n  Log.error(\n    `webpack 5 version must be greater than v5.11.1 to work properly with Next.js, please upgrade to continue!\\nSee more info here: https://err.sh/next.js/invalid-webpack-5-version`\n  )\n  process.exit(1)\n}\n\nconst devtoolRevertWarning = execOnce((devtool: Configuration['devtool']) => {\n  console.warn(\n    chalk.yellow.bold('Warning: ') +\n      chalk.bold(`Reverting webpack devtool to '${devtool}'.\\n`) +\n      'Changing the webpack devtool in development mode will cause severe performance regressions.\\n' +\n      'Read more: https://err.sh/next.js/improper-devtool'\n  )\n})\n\nfunction parseJsonFile(filePath: string) {\n  const JSON5 = require('next/dist/compiled/json5')\n  const contents = readFileSync(filePath, 'utf8')\n\n  // Special case an empty file\n  if (contents.trim() === '') {\n    return {}\n  }\n\n  try {\n    return JSON5.parse(contents)\n  } catch (err) {\n    const codeFrame = codeFrameColumns(\n      String(contents),\n      { start: { line: err.lineNumber, column: err.columnNumber } },\n      { message: err.message, highlightCode: true }\n    )\n    throw new Error(`Failed to parse \"${filePath}\":\\n${codeFrame}`)\n  }\n}\n\nfunction getOptimizedAliases(isServer: boolean): { [pkg: string]: string } {\n  if (isServer) {\n    return {}\n  }\n\n  const stubWindowFetch = path.join(__dirname, 'polyfills', 'fetch', 'index.js')\n  const stubObjectAssign = path.join(__dirname, 'polyfills', 'object-assign.js')\n\n  const shimAssign = path.join(__dirname, 'polyfills', 'object.assign')\n  return Object.assign(\n    {},\n    {\n      unfetch$: stubWindowFetch,\n      'isomorphic-unfetch$': stubWindowFetch,\n      'whatwg-fetch$': path.join(\n        __dirname,\n        'polyfills',\n        'fetch',\n        'whatwg-fetch.js'\n      ),\n    },\n    {\n      'object-assign$': stubObjectAssign,\n\n      // Stub Package: object.assign\n      'object.assign/auto': path.join(shimAssign, 'auto.js'),\n      'object.assign/implementation': path.join(\n        shimAssign,\n        'implementation.js'\n      ),\n      'object.assign$': path.join(shimAssign, 'index.js'),\n      'object.assign/polyfill': path.join(shimAssign, 'polyfill.js'),\n      'object.assign/shim': path.join(shimAssign, 'shim.js'),\n\n      // Replace: full URL polyfill with platform-based polyfill\n      url: require.resolve('native-url'),\n    }\n  )\n}\n\ntype ClientEntries = {\n  [key: string]: string | string[]\n}\n\nexport function attachReactRefresh(\n  webpackConfig: webpack.Configuration,\n  targetLoader: webpack.RuleSetUseItem\n) {\n  let injections = 0\n  const reactRefreshLoaderName = '@next/react-refresh-utils/loader'\n  const reactRefreshLoader = require.resolve(reactRefreshLoaderName)\n  webpackConfig.module?.rules.forEach((rule) => {\n    const curr = rule.use\n    // When the user has configured `defaultLoaders.babel` for a input file:\n    if (curr === targetLoader) {\n      ++injections\n      rule.use = [reactRefreshLoader, curr as webpack.RuleSetUseItem]\n    } else if (\n      Array.isArray(curr) &&\n      curr.some((r) => r === targetLoader) &&\n      // Check if loader already exists:\n      !curr.some(\n        (r) => r === reactRefreshLoader || r === reactRefreshLoaderName\n      )\n    ) {\n      ++injections\n      const idx = curr.findIndex((r) => r === targetLoader)\n      // Clone to not mutate user input\n      rule.use = [...curr]\n\n      // inject / input: [other, babel] output: [other, refresh, babel]:\n      rule.use.splice(idx, 0, reactRefreshLoader)\n    }\n  })\n\n  if (injections) {\n    Log.info(\n      `automatically enabled Fast Refresh for ${injections} custom loader${\n        injections > 1 ? 's' : ''\n      }`\n    )\n  }\n}\n\nexport default async function getBaseWebpackConfig(\n  dir: string,\n  {\n    buildId,\n    config,\n    dev = false,\n    isServer = false,\n    pagesDir,\n    tracer,\n    target = 'server',\n    reactProductionProfiling = false,\n    entrypoints,\n    rewrites,\n  }: {\n    buildId: string\n    config: NextConfig\n    dev?: boolean\n    isServer?: boolean\n    pagesDir: string\n    target?: string\n    tracer?: any\n    reactProductionProfiling?: boolean\n    entrypoints: WebpackEntrypoints\n    rewrites: Rewrite[]\n  }\n): Promise<webpack.Configuration> {\n  let plugins: PluginMetaData[] = []\n  let babelPresetPlugins: { dir: string; config: any }[] = []\n\n  const hasRewrites = rewrites.length > 0 || dev\n\n  if (config.experimental.plugins) {\n    plugins = await collectPlugins(dir, config.env, config.plugins)\n    pluginLoaderOptions.plugins = plugins\n\n    for (const plugin of plugins) {\n      if (plugin.middleware.includes('babel-preset-build')) {\n        babelPresetPlugins.push({\n          dir: plugin.directory,\n          config: plugin.config,\n        })\n      }\n    }\n  }\n\n  const reactVersion = await getPackageVersion({ cwd: dir, name: 'react' })\n  const hasReactRefresh: boolean = dev && !isServer\n  const hasJsxRuntime: boolean =\n    Boolean(reactVersion) &&\n    // 17.0.0-rc.0 had a breaking change not compatible with Next.js, but was\n    // fixed in rc.1.\n    semver.gte(reactVersion!, '17.0.0-rc.1')\n\n  const distDir = path.join(dir, config.distDir)\n  const defaultLoaders = {\n    babel: {\n      loader: 'next-babel-loader',\n      options: {\n        isServer,\n        distDir,\n        pagesDir,\n        cwd: dir,\n        // Webpack 5 has a built-in loader cache\n        cache: !isWebpack5,\n        babelPresetPlugins,\n        development: dev,\n        hasReactRefresh,\n        hasJsxRuntime,\n      },\n    },\n    // Backwards compat\n    hotSelfAccept: {\n      loader: 'noop-loader',\n    },\n  }\n\n  const babelIncludeRegexes: RegExp[] = [\n    /next[\\\\/]dist[\\\\/]next-server[\\\\/]lib/,\n    /next[\\\\/]dist[\\\\/]client/,\n    /next[\\\\/]dist[\\\\/]pages/,\n    /[\\\\/](strip-ansi|ansi-regex)[\\\\/]/,\n    ...(config.experimental.plugins\n      ? VALID_MIDDLEWARE.map((name) => new RegExp(`src(\\\\\\\\|/)${name}`))\n      : []),\n  ]\n\n  // Support for NODE_PATH\n  const nodePathList = (process.env.NODE_PATH || '')\n    .split(process.platform === 'win32' ? ';' : ':')\n    .filter((p) => !!p)\n\n  const isServerless = target === 'serverless'\n  const isServerlessTrace = target === 'experimental-serverless-trace'\n  // Intentionally not using isTargetLikeServerless helper\n  const isLikeServerless = isServerless || isServerlessTrace\n\n  const outputDir = isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY\n  const outputPath = path.join(distDir, isServer ? outputDir : '')\n  const totalPages = Object.keys(entrypoints).length\n  const clientEntries = !isServer\n    ? ({\n        // Backwards compatibility\n        'main.js': [],\n        [CLIENT_STATIC_FILES_RUNTIME_MAIN]:\n          `./` +\n          path\n            .relative(\n              dir,\n              path.join(\n                NEXT_PROJECT_ROOT_DIST_CLIENT,\n                dev ? `next-dev.js` : 'next.js'\n              )\n            )\n            .replace(/\\\\/g, '/'),\n        [CLIENT_STATIC_FILES_RUNTIME_POLYFILLS]: path.join(\n          NEXT_PROJECT_ROOT_DIST_CLIENT,\n          'polyfills.js'\n        ),\n      } as ClientEntries)\n    : undefined\n\n  let typeScriptPath: string | undefined\n  try {\n    typeScriptPath = resolveRequest('typescript', `${dir}/`)\n  } catch (_) {}\n  const tsConfigPath = path.join(dir, 'tsconfig.json')\n  const useTypeScript = Boolean(\n    typeScriptPath && (await fileExists(tsConfigPath))\n  )\n\n  let jsConfig\n  // jsconfig is a subset of tsconfig\n  if (useTypeScript) {\n    const ts = (await import(typeScriptPath!)) as typeof import('typescript')\n    const tsConfig = await getTypeScriptConfiguration(ts, tsConfigPath)\n    jsConfig = { compilerOptions: tsConfig.options }\n  }\n\n  const jsConfigPath = path.join(dir, 'jsconfig.json')\n  if (!useTypeScript && (await fileExists(jsConfigPath))) {\n    jsConfig = parseJsonFile(jsConfigPath)\n  }\n\n  let resolvedBaseUrl\n  if (jsConfig?.compilerOptions?.baseUrl) {\n    resolvedBaseUrl = path.resolve(dir, jsConfig.compilerOptions.baseUrl)\n  }\n\n  function getReactProfilingInProduction() {\n    if (reactProductionProfiling) {\n      return {\n        'react-dom$': 'react-dom/profiling',\n        'scheduler/tracing': 'scheduler/tracing-profiling',\n      }\n    }\n  }\n\n  const clientResolveRewrites = require.resolve(\n    'next/dist/next-server/lib/router/utils/resolve-rewrites'\n  )\n\n  const resolveConfig = {\n    // Disable .mjs for node_modules bundling\n    extensions: isServer\n      ? [\n          '.js',\n          '.mjs',\n          ...(useTypeScript ? ['.tsx', '.ts'] : []),\n          '.jsx',\n          '.json',\n          '.wasm',\n        ]\n      : [\n          '.mjs',\n          '.js',\n          ...(useTypeScript ? ['.tsx', '.ts'] : []),\n          '.jsx',\n          '.json',\n          '.wasm',\n        ],\n    modules: [\n      'node_modules',\n      ...nodePathList, // Support for NODE_PATH environment variable\n    ],\n    alias: {\n      next: NEXT_PROJECT_ROOT,\n      ...(isWebpack5 && !isServer\n        ? {\n            stream: require.resolve('stream-browserify'),\n            path: require.resolve('path-browserify'),\n            crypto: require.resolve('crypto-browserify'),\n            buffer: require.resolve('buffer'),\n            vm: require.resolve('vm-browserify'),\n          }\n        : undefined),\n      [PAGES_DIR_ALIAS]: pagesDir,\n      [DOT_NEXT_ALIAS]: distDir,\n      ...getOptimizedAliases(isServer),\n      ...getReactProfilingInProduction(),\n      [clientResolveRewrites]: hasRewrites\n        ? clientResolveRewrites\n        : require.resolve('next/dist/client/dev/noop.js'),\n    },\n    mainFields: isServer ? ['main', 'module'] : ['browser', 'module', 'main'],\n    plugins: isWebpack5\n      ? // webpack 5+ has the PnP resolver built-in by default:\n        []\n      : [require('pnp-webpack-plugin')],\n  }\n\n  const terserOptions: any = {\n    parse: {\n      ecma: 8,\n    },\n    compress: {\n      ecma: 5,\n      warnings: false,\n      // The following two options are known to break valid JavaScript code\n      comparisons: false,\n      inline: 2, // https://github.com/vercel/next.js/issues/7178#issuecomment-493048965\n    },\n    mangle: { safari10: true },\n    output: {\n      ecma: 5,\n      safari10: true,\n      comments: false,\n      // Fixes usage of Emoji and certain Regex\n      ascii_only: true,\n    },\n  }\n\n  const isModuleCSS = (module: { type: string }): boolean => {\n    return (\n      // mini-css-extract-plugin\n      module.type === `css/mini-extract` ||\n      // extract-css-chunks-webpack-plugin (old)\n      module.type === `css/extract-chunks` ||\n      // extract-css-chunks-webpack-plugin (new)\n      module.type === `css/extract-css-chunks`\n    )\n  }\n\n  // Contains various versions of the Webpack SplitChunksPlugin used in different build types\n  const splitChunksConfigs: {\n    [propName: string]: webpack.Options.SplitChunksOptions\n  } = {\n    dev: {\n      cacheGroups: {\n        default: false,\n        vendors: false,\n        // In webpack 5 vendors was renamed to defaultVendors\n        defaultVendors: false,\n      },\n    },\n    prodGranular: {\n      chunks: 'all',\n      cacheGroups: {\n        default: false,\n        vendors: false,\n        // In webpack 5 vendors was renamed to defaultVendors\n        defaultVendors: false,\n        framework: {\n          chunks: 'all',\n          name: 'framework',\n          // This regex ignores nested copies of framework libraries so they're\n          // bundled with their issuer.\n          // https://github.com/vercel/next.js/pull/9012\n          test: /(?<!node_modules.*)[\\\\/]node_modules[\\\\/](react|react-dom|scheduler|prop-types|use-subscription)[\\\\/]/,\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from\n          // becoming a part of the commons chunk)\n          enforce: true,\n        },\n        lib: {\n          test(module: { size: Function; identifier: Function }): boolean {\n            return (\n              module.size() > 160000 &&\n              /node_modules[/\\\\]/.test(module.identifier())\n            )\n          },\n          name(module: {\n            type: string\n            libIdent?: Function\n            updateHash: (hash: crypto.Hash) => void\n          }): string {\n            const hash = crypto.createHash('sha1')\n            if (isModuleCSS(module)) {\n              module.updateHash(hash)\n            } else {\n              if (!module.libIdent) {\n                throw new Error(\n                  `Encountered unknown module type: ${module.type}. Please open an issue.`\n                )\n              }\n\n              hash.update(module.libIdent({ context: dir }))\n            }\n\n            return hash.digest('hex').substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n        commons: {\n          name: 'commons',\n          minChunks: totalPages,\n          priority: 20,\n        },\n        shared: {\n          name(module, chunks) {\n            return (\n              crypto\n                .createHash('sha1')\n                .update(\n                  chunks.reduce(\n                    (acc: string, chunk: webpack.compilation.Chunk) => {\n                      return acc + chunk.name\n                    },\n                    ''\n                  )\n                )\n                .digest('hex') + (isModuleCSS(module) ? '_CSS' : '')\n            )\n          },\n          priority: 10,\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n      },\n      maxInitialRequests: 25,\n      minSize: 20000,\n    },\n  }\n\n  // Select appropriate SplitChunksPlugin config for this build\n  let splitChunksConfig: webpack.Options.SplitChunksOptions\n  if (dev) {\n    splitChunksConfig = splitChunksConfigs.dev\n  } else {\n    splitChunksConfig = splitChunksConfigs.prodGranular\n  }\n\n  const crossOrigin = config.crossOrigin\n\n  let customAppFile: string | null = await findPageFile(\n    pagesDir,\n    '/_app',\n    config.pageExtensions\n  )\n  if (customAppFile) {\n    customAppFile = path.resolve(path.join(pagesDir, customAppFile))\n  }\n\n  const conformanceConfig = Object.assign(\n    {\n      ReactSyncScriptsConformanceCheck: {\n        enabled: true,\n      },\n      MinificationConformanceCheck: {\n        enabled: true,\n      },\n      DuplicatePolyfillsConformanceCheck: {\n        enabled: true,\n        BlockedAPIToBePolyfilled: Object.assign(\n          [],\n          ['fetch'],\n          config.conformance?.DuplicatePolyfillsConformanceCheck\n            ?.BlockedAPIToBePolyfilled || []\n        ),\n      },\n      GranularChunksConformanceCheck: {\n        enabled: true,\n      },\n    },\n    config.conformance\n  )\n\n  function handleExternals(context: any, request: any, callback: any) {\n    if (request === 'next') {\n      return callback(undefined, `commonjs ${request}`)\n    }\n\n    const notExternalModules = [\n      'next/app',\n      'next/document',\n      'next/link',\n      'next/image',\n      'next/error',\n      'string-hash',\n      'next/constants',\n    ]\n\n    if (notExternalModules.indexOf(request) !== -1) {\n      return callback()\n    }\n\n    // We need to externalize internal requests for files intended to\n    // not be bundled.\n\n    const isLocal: boolean =\n      request.startsWith('.') ||\n      // Always check for unix-style path, as webpack sometimes\n      // normalizes as posix.\n      path.posix.isAbsolute(request) ||\n      // When on Windows, we also want to check for Windows-specific\n      // absolute paths.\n      (process.platform === 'win32' && path.win32.isAbsolute(request))\n    const isLikelyNextExternal =\n      isLocal && /[/\\\\]next-server[/\\\\]/.test(request)\n\n    // Relative requires don't need custom resolution, because they\n    // are relative to requests we've already resolved here.\n    // Absolute requires (require('/foo')) are extremely uncommon, but\n    // also have no need for customization as they're already resolved.\n    if (isLocal && !isLikelyNextExternal) {\n      return callback()\n    }\n\n    // Resolve the import with the webpack provided context, this\n    // ensures we're resolving the correct version when multiple\n    // exist.\n    let res: string\n    try {\n      res = resolveRequest(request, `${context}/`)\n    } catch (err) {\n      // If the request cannot be resolved, we need to tell webpack to\n      // \"bundle\" it so that webpack shows an error (that it cannot be\n      // resolved).\n      return callback()\n    }\n\n    // Same as above, if the request cannot be resolved we need to have\n    // webpack \"bundle\" it so it surfaces the not found error.\n    if (!res) {\n      return callback()\n    }\n\n    let isNextExternal: boolean = false\n    if (isLocal) {\n      // we need to process next-server/lib/router/router so that\n      // the DefinePlugin can inject process.env values\n      isNextExternal = /next[/\\\\]dist[/\\\\]next-server[/\\\\](?!lib[/\\\\]router[/\\\\]router)/.test(\n        res\n      )\n\n      if (!isNextExternal) {\n        return callback()\n      }\n    }\n\n    // `isNextExternal` special cases Next.js' internal requires that\n    // should not be bundled. We need to skip the base resolve routine\n    // to prevent it from being bundled (assumes Next.js version cannot\n    // mismatch).\n    if (!isNextExternal) {\n      // Bundled Node.js code is relocated without its node_modules tree.\n      // This means we need to make sure its request resolves to the same\n      // package that'll be available at runtime. If it's not identical,\n      // we need to bundle the code (even if it _should_ be external).\n      let baseRes: string | null\n      try {\n        baseRes = resolveRequest(request, `${dir}/`)\n      } catch (err) {\n        baseRes = null\n      }\n\n      // Same as above: if the package, when required from the root,\n      // would be different from what the real resolution would use, we\n      // cannot externalize it.\n      if (\n        !baseRes ||\n        (baseRes !== res &&\n          // if res and baseRes are symlinks they could point to the the same file\n          realpathSync(baseRes) !== realpathSync(res))\n      ) {\n        return callback()\n      }\n    }\n\n    // Default pages have to be transpiled\n    if (\n      !res.match(/next[/\\\\]dist[/\\\\]next-server[/\\\\]/) &&\n      (res.match(/[/\\\\]next[/\\\\]dist[/\\\\]/) ||\n        // This is the @babel/plugin-transform-runtime \"helpers: true\" option\n        res.match(/node_modules[/\\\\]@babel[/\\\\]runtime[/\\\\]/))\n    ) {\n      return callback()\n    }\n\n    // Webpack itself has to be compiled because it doesn't always use module relative paths\n    if (\n      res.match(/node_modules[/\\\\]webpack/) ||\n      res.match(/node_modules[/\\\\]css-loader/)\n    ) {\n      return callback()\n    }\n\n    // Anything else that is standard JavaScript within `node_modules`\n    // can be externalized.\n    if (isNextExternal || res.match(/node_modules[/\\\\].*\\.js$/)) {\n      const externalRequest = isNextExternal\n        ? // Generate Next.js external import\n          path.posix.join(\n            'next',\n            'dist',\n            path\n              .relative(\n                // Root of Next.js package:\n                path.join(__dirname, '..'),\n                res\n              )\n              // Windows path normalization\n              .replace(/\\\\/g, '/')\n          )\n        : request\n\n      return callback(undefined, `commonjs ${externalRequest}`)\n    }\n\n    // Default behavior: bundle the code!\n    callback()\n  }\n\n  const emacsLockfilePattern = '**/.#*'\n\n  let webpackConfig: webpack.Configuration = {\n    externals: !isServer\n      ? // make sure importing \"next\" is handled gracefully for client\n        // bundles in case a user imported types and it wasn't removed\n        // TODO: should we warn/error for this instead?\n        ['next']\n      : !isServerless\n      ? [\n          isWebpack5\n            ? ({ context, request }, callback) =>\n                handleExternals(context, request, callback)\n            : (context, request, callback) =>\n                handleExternals(context, request, callback),\n        ]\n      : [\n          // When the 'serverless' target is used all node_modules will be compiled into the output bundles\n          // So that the 'serverless' bundles have 0 runtime dependencies\n          '@ampproject/toolbox-optimizer', // except this one\n\n          // Mark this as external if not enabled so it doesn't cause a\n          // webpack error from being missing\n          ...(config.experimental.optimizeCss ? [] : ['critters']),\n        ],\n    optimization: {\n      // Webpack 5 uses a new property for the same functionality\n      ...(isWebpack5 ? { emitOnErrors: !dev } : { noEmitOnErrors: dev }),\n      checkWasmTypes: false,\n      nodeEnv: false,\n      splitChunks: isServer ? false : splitChunksConfig,\n      runtimeChunk: isServer\n        ? isWebpack5 && !isLikeServerless\n          ? { name: 'webpack-runtime' }\n          : undefined\n        : { name: CLIENT_STATIC_FILES_RUNTIME_WEBPACK },\n      minimize: !(dev || isServer),\n      minimizer: [\n        // Minify JavaScript\n        new TerserPlugin({\n          cacheDir: path.join(distDir, 'cache', 'next-minifier'),\n          parallel: config.experimental.cpus,\n          terserOptions,\n        }),\n        // Minify CSS\n        new CssMinimizerPlugin({\n          postcssOptions: {\n            map: {\n              // `inline: false` generates the source map in a separate file.\n              // Otherwise, the CSS file is needlessly large.\n              inline: false,\n              // `annotation: false` skips appending the `sourceMappingURL`\n              // to the end of the CSS file. Webpack already handles this.\n              annotation: false,\n            },\n          },\n        }),\n      ],\n    },\n    context: dir,\n    node: {\n      setImmediate: false,\n    },\n    // Kept as function to be backwards compatible\n    entry: async () => {\n      return {\n        ...(clientEntries ? clientEntries : {}),\n        ...entrypoints,\n        ...(isServer\n          ? {\n              'init-server.js': 'next-plugin-loader?middleware=on-init-server!',\n              'on-error-server.js':\n                'next-plugin-loader?middleware=on-error-server!',\n            }\n          : {}),\n      }\n    },\n    watchOptions: {\n      ignored: [\n        '**/.git/**',\n        '**/node_modules/**',\n        '**/.next/**',\n        // can be removed after https://github.com/paulmillr/chokidar/issues/955 is released\n        emacsLockfilePattern,\n      ],\n    },\n    output: {\n      ...(isWebpack5\n        ? {\n            environment: {\n              arrowFunction: false,\n              bigIntLiteral: false,\n              const: false,\n              destructuring: false,\n              dynamicImport: false,\n              forOf: false,\n              module: false,\n            },\n          }\n        : {}),\n      path: outputPath,\n      // On the server we don't use the chunkhash\n      filename: isServer\n        ? '[name].js'\n        : `static/chunks/[name]${dev ? '' : '-[chunkhash]'}.js`,\n      library: isServer ? undefined : '_N_E',\n      libraryTarget: isServer ? 'commonjs2' : 'assign',\n      hotUpdateChunkFilename: isWebpack5\n        ? 'static/webpack/[id].[fullhash].hot-update.js'\n        : 'static/webpack/[id].[hash].hot-update.js',\n      hotUpdateMainFilename: isWebpack5\n        ? 'static/webpack/[fullhash].hot-update.json'\n        : 'static/webpack/[hash].hot-update.json',\n      // This saves chunks with the name given via `import()`\n      chunkFilename: isServer\n        ? `${dev ? '[name]' : '[name].[contenthash]'}.js`\n        : `static/chunks/${dev ? '[name]' : '[name].[contenthash]'}.js`,\n      strictModuleExceptionHandling: true,\n      crossOriginLoading: crossOrigin,\n      futureEmitAssets: !dev,\n      webassemblyModuleFilename: 'static/wasm/[modulehash].wasm',\n    },\n    performance: false,\n    resolve: resolveConfig,\n    resolveLoader: {\n      // The loaders Next.js provides\n      alias: [\n        'emit-file-loader',\n        'error-loader',\n        'next-babel-loader',\n        'next-client-pages-loader',\n        'next-serverless-loader',\n        'noop-loader',\n        'next-plugin-loader',\n      ].reduce((alias, loader) => {\n        // using multiple aliases to replace `resolveLoader.modules`\n        alias[loader] = path.join(__dirname, 'webpack', 'loaders', loader)\n\n        return alias\n      }, {} as Record<string, string>),\n      modules: [\n        'node_modules',\n        ...nodePathList, // Support for NODE_PATH environment variable\n      ],\n      plugins: isWebpack5 ? [] : [require('pnp-webpack-plugin')],\n    },\n    module: {\n      rules: [\n        ...(isWebpack5\n          ? [\n              // TODO: FIXME: do NOT webpack 5 support with this\n              // x-ref: https://github.com/webpack/webpack/issues/11467\n              {\n                test: /\\.m?js/,\n                resolve: {\n                  fullySpecified: false,\n                },\n              } as any,\n            ]\n          : []),\n        {\n          test: /\\.(tsx|ts|js|mjs|jsx)$/,\n          include: [dir, ...babelIncludeRegexes],\n          exclude: (excludePath: string) => {\n            if (babelIncludeRegexes.some((r) => r.test(excludePath))) {\n              return false\n            }\n            return /node_modules/.test(excludePath)\n          },\n          use: config.experimental.babelMultiThread\n            ? [\n                // Move Babel transpilation into a thread pool (2 workers, unlimited batch size).\n                // Applying a cache to the off-thread work avoids paying transfer costs for unchanged modules.\n                {\n                  loader: 'next/dist/compiled/cache-loader',\n                  options: {\n                    cacheContext: dir,\n                    cacheDirectory: path.join(dir, '.next', 'cache', 'webpack'),\n                    cacheIdentifier: `webpack${isServer ? '-server' : ''}`,\n                  },\n                },\n                {\n                  loader: require.resolve('next/dist/compiled/thread-loader'),\n                  options: {\n                    workers: 2,\n                    workerParallelJobs: Infinity,\n                  },\n                },\n                hasReactRefresh\n                  ? require.resolve('@next/react-refresh-utils/loader')\n                  : '',\n                defaultLoaders.babel,\n              ].filter(Boolean)\n            : hasReactRefresh\n            ? [\n                require.resolve('@next/react-refresh-utils/loader'),\n                defaultLoaders.babel,\n              ]\n            : defaultLoaders.babel,\n        },\n      ].filter(Boolean),\n    },\n    plugins: [\n      hasReactRefresh && new ReactRefreshWebpackPlugin(),\n      // Makes sure `Buffer` is polyfilled in client-side bundles (same behavior as webpack 4)\n      isWebpack5 &&\n        !isServer &&\n        new webpack.ProvidePlugin({ Buffer: ['buffer', 'Buffer'] }),\n      // Makes sure `process` is polyfilled in client-side bundles (same behavior as webpack 4)\n      isWebpack5 &&\n        !isServer &&\n        new webpack.ProvidePlugin({ process: ['process'] }),\n      // This plugin makes sure `output.filename` is used for entry chunks\n      !isWebpack5 && new ChunkNamesPlugin(),\n      new webpack.DefinePlugin({\n        ...Object.keys(process.env).reduce(\n          (prev: { [key: string]: string }, key: string) => {\n            if (key.startsWith('NEXT_PUBLIC_')) {\n              prev[`process.env.${key}`] = JSON.stringify(process.env[key]!)\n            }\n            return prev\n          },\n          {}\n        ),\n        ...Object.keys(config.env).reduce((acc, key) => {\n          if (/^(?:NODE_.+)|^(?:__.+)$/i.test(key)) {\n            throw new Error(\n              `The key \"${key}\" under \"env\" in next.config.js is not allowed. https://err.sh/vercel/next.js/env-key-not-allowed`\n            )\n          }\n\n          return {\n            ...acc,\n            [`process.env.${key}`]: JSON.stringify(config.env[key]),\n          }\n        }, {}),\n        // TODO: enforce `NODE_ENV` on `process.env`, and add a test:\n        'process.env.NODE_ENV': JSON.stringify(\n          dev ? 'development' : 'production'\n        ),\n        'process.env.__NEXT_CROSS_ORIGIN': JSON.stringify(crossOrigin),\n        'process.browser': JSON.stringify(!isServer),\n        'process.env.__NEXT_TEST_MODE': JSON.stringify(\n          process.env.__NEXT_TEST_MODE\n        ),\n        // This is used in client/dev-error-overlay/hot-dev-client.js to replace the dist directory\n        ...(dev && !isServer\n          ? {\n              'process.env.__NEXT_DIST_DIR': JSON.stringify(distDir),\n            }\n          : {}),\n        'process.env.__NEXT_TRAILING_SLASH': JSON.stringify(\n          config.trailingSlash\n        ),\n        'process.env.__NEXT_BUILD_INDICATOR': JSON.stringify(\n          config.devIndicators.buildActivity\n        ),\n        'process.env.__NEXT_PLUGINS': JSON.stringify(\n          config.experimental.plugins\n        ),\n        'process.env.__NEXT_STRICT_MODE': JSON.stringify(\n          config.reactStrictMode\n        ),\n        'process.env.__NEXT_REACT_MODE': JSON.stringify(\n          config.experimental.reactMode\n        ),\n        'process.env.__NEXT_OPTIMIZE_FONTS': JSON.stringify(\n          config.experimental.optimizeFonts && !dev\n        ),\n        'process.env.__NEXT_OPTIMIZE_IMAGES': JSON.stringify(\n          config.experimental.optimizeImages\n        ),\n        'process.env.__NEXT_OPTIMIZE_CSS': JSON.stringify(\n          !!config.experimental.optimizeCss && !dev\n        ),\n        'process.env.__NEXT_SCROLL_RESTORATION': JSON.stringify(\n          config.experimental.scrollRestoration\n        ),\n        'process.env.__NEXT_IMAGE_OPTS': JSON.stringify({\n          deviceSizes: config.images.deviceSizes,\n          imageSizes: config.images.imageSizes,\n          path: config.images.path,\n          loader: config.images.loader,\n          ...(dev\n            ? {\n                // pass domains in development to allow validating on the client\n                domains: config.images.domains,\n              }\n            : {}),\n        }),\n        'process.env.__NEXT_ROUTER_BASEPATH': JSON.stringify(config.basePath),\n        'process.env.__NEXT_HAS_REWRITES': JSON.stringify(hasRewrites),\n        'process.env.__NEXT_I18N_SUPPORT': JSON.stringify(!!config.i18n),\n        'process.env.__NEXT_I18N_DOMAINS': JSON.stringify(config.i18n?.domains),\n        'process.env.__NEXT_ANALYTICS_ID': JSON.stringify(config.analyticsId),\n        ...(isServer\n          ? {\n              // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)\n              // This is typically found in unmaintained modules from the\n              // pre-webpack era (common in server-side code)\n              'global.GENTLY': JSON.stringify(false),\n            }\n          : undefined),\n        // stub process.env with proxy to warn a missing value is\n        // being accessed in development mode\n        ...(config.experimental.pageEnv && dev\n          ? {\n              'process.env': `\n            new Proxy(${isServer ? 'process.env' : '{}'}, {\n              get(target, prop) {\n                if (typeof target[prop] === 'undefined') {\n                  console.warn(\\`An environment variable (\\${prop}) that was not provided in the environment was accessed.\\nSee more info here: https://err.sh/next.js/missing-env-value\\`)\n                }\n                return target[prop]\n              }\n            })\n          `,\n            }\n          : {}),\n      }),\n      !isServer &&\n        new ReactLoadablePlugin({\n          filename: REACT_LOADABLE_MANIFEST,\n        }),\n      !isServer && new DropClientPage(),\n      // Moment.js is an extremely popular library that bundles large locale files\n      // by default due to how Webpack interprets its code. This is a practical\n      // solution that requires the user to opt into importing specific locales.\n      // https://github.com/jmblog/how-to-optimize-momentjs-with-webpack\n      config.future.excludeDefaultMomentLocales &&\n        new webpack.IgnorePlugin({\n          resourceRegExp: /^\\.\\/locale$/,\n          contextRegExp: /moment$/,\n        }),\n      ...(dev\n        ? (() => {\n            // Even though require.cache is server only we have to clear assets from both compilations\n            // This is because the client compilation generates the build manifest that's used on the server side\n            const {\n              NextJsRequireCacheHotReloader,\n            } = require('./webpack/plugins/nextjs-require-cache-hot-reloader')\n            const devPlugins = [new NextJsRequireCacheHotReloader()]\n\n            if (!isServer) {\n              devPlugins.push(new webpack.HotModuleReplacementPlugin())\n            }\n\n            return devPlugins\n          })()\n        : []),\n      // Webpack 5 no longer requires this plugin in production:\n      !isWebpack5 && !dev && new webpack.HashedModuleIdsPlugin(),\n      !dev &&\n        new webpack.IgnorePlugin({\n          resourceRegExp: /react-is/,\n          contextRegExp: /(next-server|next)[\\\\/]dist[\\\\/]/,\n        }),\n      isServerless && isServer && new ServerlessPlugin(),\n      isServer && new PagesManifestPlugin(isLikeServerless),\n      !isWebpack5 &&\n        target === 'server' &&\n        isServer &&\n        new NextJsSSRModuleCachePlugin({ outputPath }),\n      isServer && new NextJsSsrImportPlugin(),\n      !isServer &&\n        new BuildManifestPlugin({\n          buildId,\n          rewrites,\n        }),\n      tracer &&\n        new ProfilingPlugin({\n          tracer,\n        }),\n      config.experimental.optimizeFonts &&\n        !dev &&\n        isServer &&\n        (function () {\n          const {\n            FontStylesheetGatheringPlugin,\n          } = require('./webpack/plugins/font-stylesheet-gathering-plugin')\n          return new FontStylesheetGatheringPlugin()\n        })(),\n      config.experimental.conformance &&\n        !isWebpack5 &&\n        !dev &&\n        new WebpackConformancePlugin({\n          tests: [\n            !isServer &&\n              conformanceConfig.MinificationConformanceCheck.enabled &&\n              new MinificationConformanceCheck(),\n            conformanceConfig.ReactSyncScriptsConformanceCheck.enabled &&\n              new ReactSyncScriptsConformanceCheck({\n                AllowedSources:\n                  conformanceConfig.ReactSyncScriptsConformanceCheck\n                    .allowedSources || [],\n              }),\n            !isServer &&\n              conformanceConfig.DuplicatePolyfillsConformanceCheck.enabled &&\n              new DuplicatePolyfillsConformanceCheck({\n                BlockedAPIToBePolyfilled:\n                  conformanceConfig.DuplicatePolyfillsConformanceCheck\n                    .BlockedAPIToBePolyfilled,\n              }),\n            !isServer &&\n              conformanceConfig.GranularChunksConformanceCheck.enabled &&\n              new GranularChunksConformanceCheck(\n                splitChunksConfigs.prodGranular\n              ),\n          ].filter(Boolean),\n        }),\n      new WellKnownErrorsPlugin(),\n    ].filter((Boolean as any) as ExcludesFalse),\n  }\n\n  // Support tsconfig and jsconfig baseUrl\n  if (resolvedBaseUrl) {\n    webpackConfig.resolve?.modules?.push(resolvedBaseUrl)\n  }\n\n  if (jsConfig?.compilerOptions?.paths && resolvedBaseUrl) {\n    webpackConfig.resolve?.plugins?.unshift(\n      new JsConfigPathsPlugin(jsConfig.compilerOptions.paths, resolvedBaseUrl)\n    )\n  }\n\n  if (isWebpack5) {\n    // futureEmitAssets is on by default in webpack 5\n    delete webpackConfig.output?.futureEmitAssets\n    // webpack 5 no longer polyfills Node.js modules:\n    if (webpackConfig.node) delete webpackConfig.node.setImmediate\n\n    if (dev) {\n      if (!webpackConfig.optimization) {\n        webpackConfig.optimization = {}\n      }\n      webpackConfig.optimization.providedExports = false\n      webpackConfig.optimization.usedExports = false\n    }\n\n    const nextPublicVariables = Object.keys(process.env)\n      .reduce((acc: string[], key: string) => {\n        if (key.startsWith('NEXT_PUBLIC_')) {\n          return [...acc, `${key}=${process.env[key]}`]\n        }\n        return acc\n      }, [])\n      .join('|')\n\n    const nextEnvVariables = Object.keys(config.env).reduce(\n      (prev: string, key: string) => {\n        return `${prev}|${key}=${config.env[key]}`\n      },\n      ''\n    )\n\n    const configVars = JSON.stringify({\n      crossOrigin: config.crossOrigin,\n      pageExtensions: config.pageExtensions,\n      trailingSlash: config.trailingSlash,\n      buildActivity: config.devIndicators.buildActivity,\n      plugins: config.experimental.plugins,\n      reactStrictMode: config.reactStrictMode,\n      reactMode: config.experimental.reactMode,\n      optimizeFonts: config.experimental.optimizeFonts,\n      optimizeImages: config.experimental.optimizeImages,\n      scrollRestoration: config.experimental.scrollRestoration,\n      basePath: config.basePath,\n      pageEnv: config.experimental.pageEnv,\n      excludeDefaultMomentLocales: config.future.excludeDefaultMomentLocales,\n      assetPrefix: config.assetPrefix,\n      target,\n      reactProductionProfiling,\n    })\n\n    const cache: any = {\n      type: 'filesystem',\n      // Includes:\n      //  - Next.js version\n      //  - NEXT_PUBLIC_ variable values (they affect caching) TODO: make this module usage only\n      //  - next.config.js `env` key\n      //  - next.config.js keys that affect compilation\n      version: `${process.env.__NEXT_VERSION}|${nextPublicVariables}|${nextEnvVariables}|${configVars}`,\n      cacheDirectory: path.join(dir, '.next', 'cache', 'webpack'),\n    }\n\n    // Adds `next.config.js` as a buildDependency when custom webpack config is provided\n    if (config.webpack && config.configFile) {\n      cache.buildDependencies = {\n        config: [config.configFile],\n      }\n    }\n\n    webpackConfig.cache = cache\n\n    // @ts-ignore TODO: remove ignore when webpack 5 is stable\n    webpackConfig.optimization.realContentHash = false\n  }\n\n  webpackConfig = await buildConfiguration(webpackConfig, {\n    rootDirectory: dir,\n    customAppFile,\n    isDevelopment: dev,\n    isServer,\n    assetPrefix: config.assetPrefix || '',\n    sassOptions: config.sassOptions,\n    productionBrowserSourceMaps: config.productionBrowserSourceMaps,\n  })\n\n  let originalDevtool = webpackConfig.devtool\n  if (typeof config.webpack === 'function') {\n    webpackConfig = config.webpack(webpackConfig, {\n      dir,\n      dev,\n      isServer,\n      buildId,\n      config,\n      defaultLoaders,\n      totalPages,\n      webpack,\n    })\n\n    if (!webpackConfig) {\n      throw new Error(\n        'Webpack config is undefined. You may have forgot to return properly from within the \"webpack\" method of your next.config.js.\\n' +\n          'See more info here https://err.sh/next.js/undefined-webpack-config'\n      )\n    }\n\n    if (dev && originalDevtool !== webpackConfig.devtool) {\n      webpackConfig.devtool = originalDevtool\n      devtoolRevertWarning(originalDevtool)\n    }\n\n    if (typeof (webpackConfig as any).then === 'function') {\n      console.warn(\n        '> Promise returned in next config. https://err.sh/vercel/next.js/promise-in-next-config'\n      )\n    }\n  }\n\n  // Backwards compat with webpack-dev-middleware options object\n  if (typeof config.webpackDevMiddleware === 'function') {\n    const options = config.webpackDevMiddleware({\n      watchOptions: webpackConfig.watchOptions,\n    })\n    if (options.watchOptions) {\n      webpackConfig.watchOptions = options.watchOptions\n    }\n  }\n\n  function canMatchCss(rule: webpack.RuleSetCondition | undefined): boolean {\n    if (!rule) {\n      return false\n    }\n\n    const fileNames = [\n      '/tmp/test.css',\n      '/tmp/test.scss',\n      '/tmp/test.sass',\n      '/tmp/test.less',\n      '/tmp/test.styl',\n    ]\n\n    if (rule instanceof RegExp && fileNames.some((input) => rule.test(input))) {\n      return true\n    }\n\n    if (typeof rule === 'function') {\n      if (\n        fileNames.some((input) => {\n          try {\n            if (rule(input)) {\n              return true\n            }\n          } catch (_) {}\n          return false\n        })\n      ) {\n        return true\n      }\n    }\n\n    if (Array.isArray(rule) && rule.some(canMatchCss)) {\n      return true\n    }\n\n    return false\n  }\n\n  const hasUserCssConfig =\n    webpackConfig.module?.rules.some(\n      (rule) => canMatchCss(rule.test) || canMatchCss(rule.include)\n    ) ?? false\n\n  if (hasUserCssConfig) {\n    // only show warning for one build\n    if (isServer) {\n      console.warn(\n        chalk.yellow.bold('Warning: ') +\n          chalk.bold(\n            'Built-in CSS support is being disabled due to custom CSS configuration being detected.\\n'\n          ) +\n          'See here for more info: https://err.sh/next.js/built-in-css-disabled\\n'\n      )\n    }\n\n    if (webpackConfig.module?.rules.length) {\n      // Remove default CSS Loader\n      webpackConfig.module.rules = webpackConfig.module.rules.filter(\n        (r) =>\n          !(\n            typeof r.oneOf?.[0]?.options === 'object' &&\n            r.oneOf[0].options.__next_css_remove === true\n          )\n      )\n    }\n    if (webpackConfig.plugins?.length) {\n      // Disable CSS Extraction Plugin\n      webpackConfig.plugins = webpackConfig.plugins.filter(\n        (p) => (p as any).__next_css_remove !== true\n      )\n    }\n    if (webpackConfig.optimization?.minimizer?.length) {\n      // Disable CSS Minifier\n      webpackConfig.optimization.minimizer = webpackConfig.optimization.minimizer.filter(\n        (e) => (e as any).__next_css_remove !== true\n      )\n    }\n  } else {\n    await __overrideCssConfiguration(dir, !dev, webpackConfig)\n  }\n\n  // Inject missing React Refresh loaders so that development mode is fast:\n  if (hasReactRefresh) {\n    attachReactRefresh(webpackConfig, defaultLoaders.babel)\n  }\n\n  // check if using @zeit/next-typescript and show warning\n  if (\n    isServer &&\n    webpackConfig.module &&\n    Array.isArray(webpackConfig.module.rules)\n  ) {\n    let foundTsRule = false\n\n    webpackConfig.module.rules = webpackConfig.module.rules.filter(\n      (rule): boolean => {\n        if (!(rule.test instanceof RegExp)) return true\n        if ('noop.ts'.match(rule.test) && !'noop.js'.match(rule.test)) {\n          // remove if it matches @zeit/next-typescript\n          foundTsRule = rule.use === defaultLoaders.babel\n          return !foundTsRule\n        }\n        return true\n      }\n    )\n\n    if (foundTsRule) {\n      console.warn(\n        '\\n@zeit/next-typescript is no longer needed since Next.js has built-in support for TypeScript now. Please remove it from your next.config.js and your .babelrc\\n'\n      )\n    }\n  }\n\n  // Patch `@zeit/next-sass`, `@zeit/next-less`, `@zeit/next-stylus` for compatibility\n  if (webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    ;[].forEach.call(webpackConfig.module.rules, function (\n      rule: webpack.RuleSetRule\n    ) {\n      if (!(rule.test instanceof RegExp && Array.isArray(rule.use))) {\n        return\n      }\n\n      const isSass =\n        rule.test.source === '\\\\.scss$' || rule.test.source === '\\\\.sass$'\n      const isLess = rule.test.source === '\\\\.less$'\n      const isCss = rule.test.source === '\\\\.css$'\n      const isStylus = rule.test.source === '\\\\.styl$'\n\n      // Check if the rule we're iterating over applies to Sass, Less, or CSS\n      if (!(isSass || isLess || isCss || isStylus)) {\n        return\n      }\n\n      ;[].forEach.call(rule.use, function (use: webpack.RuleSetUseItem) {\n        if (\n          !(\n            use &&\n            typeof use === 'object' &&\n            // Identify use statements only pertaining to `css-loader`\n            (use.loader === 'css-loader' ||\n              use.loader === 'css-loader/locals') &&\n            use.options &&\n            typeof use.options === 'object' &&\n            // The `minimize` property is a good heuristic that we need to\n            // perform this hack. The `minimize` property was only valid on\n            // old `css-loader` versions. Custom setups (that aren't next-sass,\n            // next-less or next-stylus) likely have the newer version.\n            // We still handle this gracefully below.\n            (Object.prototype.hasOwnProperty.call(use.options, 'minimize') ||\n              Object.prototype.hasOwnProperty.call(\n                use.options,\n                'exportOnlyLocals'\n              ))\n          )\n        ) {\n          return\n        }\n\n        // Try to monkey patch within a try-catch. We shouldn't fail the build\n        // if we cannot pull this off.\n        // The user may not even be using the `next-sass` or `next-less` or\n        // `next-stylus` plugins.\n        // If it does work, great!\n        try {\n          // Resolve the version of `@zeit/next-css` as depended on by the Sass,\n          // Less or Stylus plugin.\n          const correctNextCss = resolveRequest(\n            '@zeit/next-css',\n            isCss\n              ? // Resolve `@zeit/next-css` from the base directory\n                `${dir}/`\n              : // Else, resolve it from the specific plugins\n                require.resolve(\n                  isSass\n                    ? '@zeit/next-sass'\n                    : isLess\n                    ? '@zeit/next-less'\n                    : isStylus\n                    ? '@zeit/next-stylus'\n                    : 'next'\n                )\n          )\n\n          // If we found `@zeit/next-css` ...\n          if (correctNextCss) {\n            // ... resolve the version of `css-loader` shipped with that\n            // package instead of whichever was hoisted highest in your\n            // `node_modules` tree.\n            const correctCssLoader = resolveRequest(use.loader, correctNextCss)\n            if (correctCssLoader) {\n              // We saved the user from a failed build!\n              use.loader = correctCssLoader\n            }\n          }\n        } catch (_) {\n          // The error is not required to be handled.\n        }\n      })\n    })\n  }\n\n  // Backwards compat for `main.js` entry key\n  const originalEntry: any = webpackConfig.entry\n  if (typeof originalEntry !== 'undefined') {\n    webpackConfig.entry = async () => {\n      const entry: WebpackEntrypoints =\n        typeof originalEntry === 'function'\n          ? await originalEntry()\n          : originalEntry\n      // Server compilation doesn't have main.js\n      if (clientEntries && entry['main.js'] && entry['main.js'].length > 0) {\n        const originalFile = clientEntries[\n          CLIENT_STATIC_FILES_RUNTIME_MAIN\n        ] as string\n        entry[CLIENT_STATIC_FILES_RUNTIME_MAIN] = [\n          ...entry['main.js'],\n          originalFile,\n        ]\n      }\n      delete entry['main.js']\n\n      return entry\n    }\n  }\n\n  if (!dev) {\n    // entry is always a function\n    webpackConfig.entry = await (webpackConfig.entry as webpack.EntryFunc)()\n  }\n\n  return webpackConfig\n}\n"]},"metadata":{},"sourceType":"script"}