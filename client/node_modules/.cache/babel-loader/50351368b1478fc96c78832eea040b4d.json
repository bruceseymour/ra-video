{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _path = require(\"path\"); // This plugin modifies the require-ensure code generated by Webpack\n// to work with Next.js SSR\n\n\nclass NextJsSsrImportPlugin {\n  apply(compiler) {\n    compiler.hooks.compilation.tap('NextJsSSRImport', compilation => {\n      compilation.mainTemplate.hooks.requireEnsure.tap('NextJsSSRImport', (code, chunk) => {\n        // Update to load chunks from our custom chunks directory\n        const outputPath = (0, _path.resolve)('/');\n        const pagePath = (0, _path.join)('/', (0, _path.dirname)(chunk.name));\n        const relativePathToBaseDir = (0, _path.relative)(pagePath, outputPath); // Make sure even in windows, the path looks like in unix\n        // Node.js require system will convert it accordingly\n\n        const relativePathToBaseDirNormalized = relativePathToBaseDir.replace(/\\\\/g, '/');\n        return code.replace('require(\"./\"', `require(\"${relativePathToBaseDirNormalized}/\"`).replace('readFile(join(__dirname', `readFile(join(__dirname, \"${relativePathToBaseDirNormalized}\"`);\n      });\n    });\n  }\n\n}\n\nexports.default = NextJsSsrImportPlugin;","map":{"version":3,"sources":["../../../../build/webpack/plugins/nextjs-ssr-import.ts"],"names":["NextJsSsrImportPlugin","apply","compiler","compilation","outputPath","pagePath","chunk","relativePathToBaseDir","relativePathToBaseDirNormalized","code"],"mappings":";;;;;AAAA,IAAA,KAAA,GAAA,OAAA,CAAA,MAAA,CAAA,C,CAGA;AACA;;;AACe,MAAMA,qBAAN,CAA4B;AACzCC,EAAAA,KAAK,CAAA,QAAA,EAAqB;AACxBC,IAAAA,QAAQ,CAARA,KAAAA,CAAAA,WAAAA,CAAAA,GAAAA,CAAAA,iBAAAA,EAAmDC,WAAD,IAAsB;AACtEA,MAAAA,WAAW,CAAXA,YAAAA,CAAAA,KAAAA,CAAAA,aAAAA,CAAAA,GAAAA,CAAAA,iBAAAA,EAEE,CAAA,IAAA,EAAA,KAAA,KAA8B;AAC5B;AACA,cAAMC,UAAU,GAAG,CAAA,GAAA,KAAA,CAAA,OAAA,EAAnB,GAAmB,CAAnB;AACA,cAAMC,QAAQ,GAAG,CAAA,GAAA,KAAA,CAAA,IAAA,EAAA,GAAA,EAAU,CAAA,GAAA,KAAA,CAAA,OAAA,EAAQC,KAAK,CAAxC,IAA2B,CAAV,CAAjB;AACA,cAAMC,qBAAqB,GAAG,CAAA,GAAA,KAAA,CAAA,QAAA,EAAA,QAAA,EAA9B,UAA8B,CAA9B,CAJ4B,CAK5B;AACA;;AACA,cAAMC,+BAA+B,GAAGD,qBAAqB,CAArBA,OAAAA,CAAAA,KAAAA,EAAxC,GAAwCA,CAAxC;AAIA,eAAOE,IAAI,CAAJA,OAAAA,CAAAA,cAAAA,EAGF,YAAWD,+BAHTC,IAAAA,EAAAA,OAAAA,CAAAA,yBAAAA,EAOF,6BAA4BD,+BAPjC,GAAOC,CAAP;AAbJN,OAAAA;AADFD,KAAAA;AAFuC;;AAAA","sourcesContent":["import { join, resolve, relative, dirname } from 'path'\nimport { Compiler } from 'webpack'\n\n// This plugin modifies the require-ensure code generated by Webpack\n// to work with Next.js SSR\nexport default class NextJsSsrImportPlugin {\n  apply(compiler: Compiler) {\n    compiler.hooks.compilation.tap('NextJsSSRImport', (compilation: any) => {\n      compilation.mainTemplate.hooks.requireEnsure.tap(\n        'NextJsSSRImport',\n        (code: string, chunk: any) => {\n          // Update to load chunks from our custom chunks directory\n          const outputPath = resolve('/')\n          const pagePath = join('/', dirname(chunk.name))\n          const relativePathToBaseDir = relative(pagePath, outputPath)\n          // Make sure even in windows, the path looks like in unix\n          // Node.js require system will convert it accordingly\n          const relativePathToBaseDirNormalized = relativePathToBaseDir.replace(\n            /\\\\/g,\n            '/'\n          )\n          return code\n            .replace(\n              'require(\"./\"',\n              `require(\"${relativePathToBaseDirNormalized}/\"`\n            )\n            .replace(\n              'readFile(join(__dirname',\n              `readFile(join(__dirname, \"${relativePathToBaseDirNormalized}\"`\n            )\n        }\n      )\n    })\n  }\n}\n"]},"metadata":{},"sourceType":"script"}